<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      direction: rtl;
    }

    th.sortable {
      cursor: pointer;
      white-space: nowrap;
    }

    .sort-arrow {
      font-size: 0.7rem;
      opacity: 0.6;
      margin-right: 4px;
    }

    header {
      background: #222;
      color: #fff;
      padding: 16px 24px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    main {
      max-width: 980px;
      margin: 16px auto 32px;
      padding: 0 12px;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      padding: 16px 18px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .card h2 {
      margin-top: 0;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 10px;
    }

    .field {
      flex: 1 1 160px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.9rem;
      font-weight: 600;
    }

    input[type="text"],
    input[type="date"],
    select {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }

    input[type="file"] {
      font-size: 0.8rem;
    }

    button {
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    button.primary {
      background: #2563eb;
      color: #fff;
    }

    button.primary:hover {
      background: #1d4ed8;
    }

    button.danger {
      background: #b91c1c;
      color: #fff;
    }

    button.danger:hover {
      background: #991b1b;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:active:not(:disabled) {
      transform: scale(0.97);
    }

    .small-text {
      font-size: 0.8rem;
      color: #555;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    th, td {
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f1f5f9;
      font-weight: 700;
    }

    tr:nth-child(even) td {
      background: #f9fafb;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .stat-box {
      border-radius: 8px;
      background: #f9fafb;
      padding: 8px;
      font-size: 0.8rem;
      text-align: center;
    }

    .stat-box strong {
      display: block;
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .btn-small {
      padding: 4px 8px;
      font-size: 0.75rem;
      border-radius: 4px;
    }

    .admin-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }

    .admin-bar-text {
      font-size: 0.8rem;
    }

    .player-cell {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      justify-content: center;
    }

    .player-avatar {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid #ddd;
    }

    /* Bonus button highlight when available */
    #bonusBtn.bonus-ready{
      background: #f59e0b;
      color: #111;
    }
    #bonusBtn:disabled{
      opacity: 0.5;
    }

    @media (max-width: 600px) {
      th, td {
        font-size: 0.8rem;
        padding: 6px 4px;
      }
    }
  
    /* ===== UI Settings: Dark Mode ===== */
    body.dark {
      background: #1e1e1e;
      color: #e5e7eb;
    }
    body.dark header { background:#202020; }
    body.dark .card { background:#252525; box-shadow:none; border:1px solid rgba(255,255,255,0.08); }
    body.dark .small-text { color:#cbd5e1; }
    body.dark input[type="text"],
    body.dark input[type="date"],
    body.dark select {
      background:#242424;
      color:#e5e7eb;
      border:1px solid rgba(255,255,255,0.15);
    }
    body.dark table { color:#e5e7eb; }
    body.dark th { background:#2a2a2a; border-bottom:1px solid rgba(255,255,255,0.08); }
    body.dark td { border-bottom:1px solid rgba(255,255,255,0.06); }
    body.dark tr:nth-child(even) td { background:#202020; }
    body.dark .stat-box { background:#242424; }
    body.dark button.primary { background:#3b82f6; }
    body.dark button.primary:hover { background:#2563eb; }
    body.dark button.danger { background:#ef4444; }
    body.dark button.danger:hover { background:#dc2626; }

    .settings-bar{
      margin-top:10px;
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
    }
    .settings-bar select, .settings-bar button{
      font-size:0.85rem;
      padding:6px 10px;
    }

  </style>

  <!-- Firebase (CDN compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<link rel="icon" href="data:,">
</head>
<body>
  <header>
    <h1 id="appTitle">Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ - </h1>
    <div class="small-text" id="subtitleRule">
      ÙƒÙ„ Ù…Ø§ØªØ´ = Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† +1 Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ / Ø§Ù„Ø®Ø³Ø±Ø§Ù† -1 Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
    </div>
  
    <div class="settings-bar">
      <button class="primary" id="themeToggleBtn" type="button">ğŸŒ™ Dark Mode</button>

      <label class="small-text" for="langSelect" id="languageLabel" style="margin:0;">Language:</label>
      <select id="langSelect">
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="en">English</option>
      </select>
    </div>

    <div id="fbStatus" class="small-text" style="margin-top:6px;"></div>

  </header>

  <main>
    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <section class="card">
      <h2 id="playersSectionTitle">ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
      <div class="row">
        <div class="field">
          <label for="playerName">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
          <input type="text" id="playerName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ØŒ Ø¹Ù„ÙŠØŒ Ø­Ø³Ø§Ù…..." />
        </div>
        <div class="field">
          <label for="playerAvatarFile">ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="file" id="playerAvatarFile" accept="image/*" />
        </div>
        <div class="field" style="align-self:flex-end;">
          <button class="primary" id="addPlayerBtn">â• Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>
        </div>
      </div>

      <!-- Ø²Ø± Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
      <div class="row" style="margin-bottom:4px;">
        <div class="field" style="flex:0 0 auto;">
          <button class="primary" id="togglePlayersListBtn">ğŸ‘¥ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
        </div>
      </div>

      <!-- ØºÙ„Ø§Ù Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§) -->
      <div id="playersListWrapper" style="display:none;">
        <div class="small-text" id="playersListInfo"></div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ -->
        <table style="margin-top:8px;">
          <thead>
            <tr>
              <th id="thPlayersNum">#</th>
              <th id="thPlayersPlayer">Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
              <th id="thPlayersActions">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="playersTableBody"></tbody>
        </table>
        <div class="small-text">
          ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù‘Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ ØªØ¶ÙŠÙ/ØªØºÙŠÙ‘Ø± ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·).
        </div>
      </div>
    </section>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø§ØªØ´ -->
    <section class="card">
      <h2 id="matchSectionTitle">ğŸ§® ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø§ØªØ´ (Ø¹Ø´Ø±Ø© ÙƒØ§Ù…Ù„Ø©)</h2>
      <div class="row">
        <div class="field">
          <label for="matchDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø§ØªØ´</label>
          <input type="date" id="matchDate" />
          <span class="small-text"><span id="matchDateHintText">Ù„Ùˆ ØªØ±ÙƒØªÙ‡ ÙØ§Ø¶ÙŠØŒ Ù‡ÙŠØªØ³Ø¬Ù„ Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</span></span>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="winnerP1" id="lblWinnerP1">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† - Ù„Ø§Ø¹Ø¨ 1</label>
          <select id="winnerP1"></select>
        </div>
        <div class="field">
          <label for="winnerP2" id="lblWinnerP2">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† - Ù„Ø§Ø¹Ø¨ 2</label>
          <select id="winnerP2"></select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="loserP1" id="lblLoserP1">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù† - Ù„Ø§Ø¹Ø¨ 1</label>
          <select id="loserP1"></select>
        </div>
        <div class="field">
          <label for="loserP2" id="lblLoserP2">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù† - Ù„Ø§Ø¹Ø¨ 2</label>
          <select id="loserP2"></select>
        </div>
      </div>

      <div class="row" style="margin-top:8px;">
        <div class="field" style="align-self:flex-end;">
          <button class="primary" id="addMatchBtn">âœ… Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø§ØªØ´</button>
        </div>
        <div class="field" style="align-self:flex-end;">
          <button class="primary" id="bonusBtn" disabled>ğŸ Ø¨ÙˆÙ†Øµ (ØºÙŠØ± Ù…ØªØ§Ø­)</button>
        </div>
      </div>
      <div class="small-text" id="matchNoteText">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø§ ÙŠÙ†ÙØ¹Ø´ ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø§ØªØ´.
      </div>
    </section>

    <!-- Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <section class="card">
      <h2 id="leaderboardSectionTitle">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
      <div class="row">
        <div class="field">
          <label for="filterYear">Ø§Ù„Ø³Ù†Ø©</label>
          <select id="filterYear">
            <option value="all">ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª</option>
          </select>
        </div>
        <div class="field">
          <label for="filterMonth">Ø§Ù„Ø´Ù‡Ø±</label>
          <select id="filterMonth">
            <option value="all">ÙƒÙ„ Ø§Ù„Ø´Ù‡ÙˆØ±</option>
            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
            <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
            <option value="3">Ù…Ø§Ø±Ø³</option>
            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
            <option value="5">Ù…Ø§ÙŠÙˆ</option>
            <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
            <option value="8">Ø£ØºØ³Ø·Ø³</option>
            <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
            <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
            <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
          </select>
        </div>
        <div class="field" style="align-self:flex-end;">
          <button id="leaderboardToggleViewBtn">ğŸ“Š Ø¹Ø±Ø¶ ØªÙØµÙŠÙ„ÙŠ</button>
        </div>
      </div>

      <div class="small-text" id="currentFilterLabel"></div>

      <table id="leaderboardTable">
        <thead id="leaderboardHead"></thead>
        <tbody id="leaderboardBody"></tbody>
      </table>
    </section>


    <!-- Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ -->
    <section class="card" id="championsLogCard">
      <h2 id="championsSectionTitle">ğŸ… Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ (Ø´Ù‡Ø±ÙŠ)</h2>
      <div class="small-text" id="championsLogHint">
        Ø§Ø®ØªØ± Ø³Ù†Ø© Ù…Ø­Ø¯Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø´Ù‡ÙˆØ± (Ù…Ø«Ù„ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ).
      </div>

      <div id="championsLogWrapper" style="display:none;">
        <div class="small-text" id="championsLogTitle" style="margin-bottom:8px;"></div>
        <table id="championsLogTable">
          <thead id="championsLogHead"></thead>
          <tbody id="championsLogBody"></tbody>
        </table>

        <div id="championsLogExtra" class="small-text" style="margin-top:10px; line-height:1.9;"></div>
      </div>
    </section>

    <!-- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª -->
    <section class="card">
      <h2 id="matchesLogSectionTitle">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª (ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª)</h2>

      <div class="row" style="margin-bottom:4px;">
        <div class="field" style="flex:0 0 auto;">
          <button class="primary" id="toggleMatchesLogBtn">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
      </div>

      <div id="matchesLogWrapper" style="display:none;">
        <div class="small-text">
          <span id="matchesLogIntro">Ø£Ø­Ø¯Ø« Ù…Ø§ØªØ´ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø£ÙŠ Ù…Ø§ØªØ´ ØºÙ„Ø· Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚ÙŠ.</span>
        </div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th id="thMatchesDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th id="thMatchesWin">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù†</th>
              <th id="thMatchesLose">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù†</th>
              <th id="thMatchesDelete">Ø­Ø°Ù</th>
            </tr>
          </thead>
          <tbody id="matchesLogBody"></tbody>
        </table>
      </div>
    </section>

    <!-- ØªØ­Ù„ÙŠÙ„ Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ -->
    <section class="card">
      <h2 id="playerAnalysisSectionTitle">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ù†ÙØ±Ø¯</h2>
      <div class="row">
        <div class="field">
          <label for="playerDetailsSelect">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨</label>
          <select id="playerDetailsSelect"></select>
        </div>
      </div>
      <div id="playerDetailsSummary" class="small-text">
        <span id="playerDetailsHelp">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„Ù‡.</span>
      </div>

      <div id="playerDetailsStats" style="margin-top:10px; display:none;">
        <div class="stats-grid">
          <div class="stat-box">
            <strong id="pTotalWins">0</strong>
            <span id="lblTotalWins">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
          </div>
          <div class="stat-box">
            <strong id="pTotalLosses">0</strong>
            <span id="lblTotalLosses">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
          </div>
          <div class="stat-box">
            <strong id="pTotalMatches">0</strong>
            <span id="lblTotalMatches">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
          </div>
          <div class="stat-box">
            <strong id="pWinRate">0%</strong>
            <span id="lblWinRatePeriod">Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
          </div>
          <div class="stat-box">
            <strong id="pBonusPlus">0</strong>
            <span id="lblBonusPlus">Ø¨ÙˆÙ†Øµ + (Ù…ÙƒØ³Ø¨)</span>
          </div>
          <div class="stat-box">
            <strong id="pBonusMinus">0</strong>
            <span id="lblBonusMinus">Ø¨ÙˆÙ†Øµ âˆ’ (Ø®Ø³Ø§Ø±Ø©)</span>
          </div>
          <div class="stat-box">
            <strong id="pBonusNet">0</strong>
            <span id="lblBonusNet">ØµØ§ÙÙŠ Ø§Ù„Ø¨ÙˆÙ†Øµ</span>
          </div>
        </div>

        <h3 style="font-size:0.95rem; margin-top:14px;" id="playerDaysAnalysisTitle">ğŸ“† ØªØ­Ù„ÙŠÙ„ Ø£ÙŠØ§Ù… Ø§Ù„ÙÙˆØ² ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h3>
        <div class="stats-grid">
          <div class="stat-box">
            <strong id="pDaysWin2">0</strong>
            <span id="lblDaysWin2">Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ Ù…Ø±ØªÙŠÙ†</span>
          </div>
          <div class="stat-box">
            <strong id="pDaysWin3">0</strong>
            <span id="lblDaysWin3">Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ 3 Ù…Ø±Ø§Øª</span>
          </div>
          <div class="stat-box">
            <strong id="pDaysWin4plus">0</strong>
            <span id="lblDaysWin4p">Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ 4 Ù…Ø±Ø§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±</span>
          </div>
          <div class="stat-box">
            <strong id="pDaysLose2">0</strong>
            <span id="lblDaysLose2">Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ Ù…Ø±ØªÙŠÙ†</span>
          </div>
          <div class="stat-box">
            <strong id="pDaysLose3">0</strong>
            <span id="lblDaysLose3">Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ 3 Ù…Ø±Ø§Øª</span>
          </div>
          <div class="stat-box">
            <strong id="pDaysLose4plus">0</strong>
            <span id="lblDaysLose4p">Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ 4 Ù…Ø±Ø§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±</span>
          </div>
        </div>

        <h3 style="font-size:0.95rem; margin-top:14px;" id="playerBestMateTitle">ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©</h3>
        <div class="stats-grid">
          <div class="stat-box">
            <strong id="pBestMateWinName">-</strong>
            <span id="lblBestMateWin">Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ù…Ø¹Ø§Ù‡</span>
            <div class="small-text">
              <span id="lblCountTimes1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:</span> <span id="pBestMateWinCount">0</span>
            </div>
          </div>
          <div class="stat-box">
            <strong id="pBestMateLoseName">-</strong>
            <span id="lblBestMateLose">Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Ù‘Øª Ù…Ø¹Ø§Ù‡</span>
            <div class="small-text">
              <span id="lblCountTimes2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:</span> <span id="pBestMateLoseCount">0</span>
            </div>
          </div>
        </div>
        <h3 style="font-size:0.95rem; margin-top:14px;" id="playerBestOppTitle">ğŸ‘Š Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©</h3>
        <div class="stats-grid">
          <div class="stat-box">
            <strong id="pBestOppWinName">-</strong>
            <span id="lblBestOppWin">Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ø¶Ø¯Ù‡</span>
            <div class="small-text">
              <span id="lblCountTimes3">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:</span> <span id="pBestOppWinCount">0</span>
            </div>
          </div>
          <div class="stat-box">
            <strong id="pBestOppLoseName">-</strong>
            <span id="lblBestOppLose">Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Øª Ø¶Ø¯Ù‡</span>
            <div class="small-text">
              <span id="lblCountTimes4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:</span> <span id="pBestOppLoseCount">0</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© -->
    <section class="card">
      <h2 id="h2hPlayersTitle">âš”ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
      <div class="row">
        <div class="field">
          <label for="h2hP1">Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„</label>
          <select id="h2hP1"></select>
        </div>
        <div class="field">
          <label for="h2hP2">Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
          <select id="h2hP2"></select>
        </div>
        
      </div>
      <div id="h2hSummary" class="small-text">
        <span id="h2hHelp">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ· "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©".</span>
      </div>
    </section>

    <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† ÙØ±Ù‚ 2 Ø¶Ø¯ 2 -->
    <section class="card">
      <h2 id="h2hTeamsTitle">ğŸ§© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† ÙØ±Ù‚ (2 Ø¶Ø¯ 2)</h2>

      <div class="row">
        <div class="field">
          <label for="h2hT1P1">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ - Ù„Ø§Ø¹Ø¨ 1</label>
          <select id="h2hT1P1"></select>
        </div>
        <div class="field">
          <label for="h2hT1P2">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ - Ù„Ø§Ø¹Ø¨ 2</label>
          <select id="h2hT1P2"></select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="h2hT2P1">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ù„Ø§Ø¹Ø¨ 1</label>
          <select id="h2hT2P1"></select>
        </div>
        <div class="field">
          <label for="h2hT2P2">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ù„Ø§Ø¹Ø¨ 2</label>
          <select id="h2hT2P2"></select>
        </div>
        
      </div>

      <div id="h2hTeamsSummary" class="small-text">
        <span id="h2hTeamsHelp">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ· "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©".</span>
      </div>
    </section>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <section class="card">
      <h2 id="adminSectionTitle">ğŸ” ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>

      <div class="admin-bar">
        <button class="primary" id="enableAdminBtn">ğŸ”‘ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
        <button class="danger" id="disableAdminBtn" style="display:none;">ğŸšª Ù‚ÙÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
        <div id="adminStatusText" class="admin-bar-text">
          ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙ‚Ø·: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯ÙŠØ±.
        </div>
      </div>

      <hr style="margin:12px 0; border:none; border-top:1px solid #eee;">

      <h3 class="small-text" style="margin-bottom:8px;" id="dataAdminTitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)</h3>
      <div class="row">
        <div class="field" style="flex:0 0 auto;">
          <button class="danger" id="resetAllBtn">ğŸ§¨ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
        <div class="field" style="flex:0 0 auto;">
          <button class="primary" id="backupBtn" disabled>ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ù‚Ø±ÙŠØ¨Ù‹Ø§)</button>
        </div>
        <div class="field" style="flex:0 0 auto;">
          <button class="primary" id="importBtn" disabled>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±ÙŠØ¨Ù‹Ø§)</button>
        </div>
        <div class="field" style="flex:0 0 auto;">
          <button class="primary" id="exportBtn" disabled>ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±ÙŠØ¨Ù‹Ø§)</button>
        </div>
      </div>

      <div class="small-text" id="adminDataNotes">
        <span id="resetWarning1">Ø²Ø± <strong>Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong> ÙŠÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø­Ø°Ø± Ø´Ø¯ÙŠØ¯).</span><br>
        <span id="resetWarning2">Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± <strong>ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§</strong>ØŒ
        ÙˆÙ‡Ù†ÙØ¹Ù‘Ù„Ù‡Ø§ Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø¶Ø¨Ø· Ù…Ù†Ø·Ù‚ Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</span>
      </div>
    </section>

    <section class="card">
      <h2 id="notesSectionTitle">â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2>
      <ul class="small-text">
        <li><span id="note1">Ù…Ù† ØºÙŠØ± ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±ØŒ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙ‚Ø·.</span></li>
        <li><span id="note2">ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙŠ Firebase FirestoreØŒ ØªÙ‚Ø¯Ø± ØªÙØªØ­ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø².</span></li>
        <li><span id="note3">Ø§Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø± Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙØªØ±Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„ØªÙ€Ø±ØªÙŠØ¨ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª.</span></li>
      </ul>
    </section>
  </main>

  <script>

// ===== Console Noise Guard (Browser Extensions) =====
// This prevents noisy console errors often caused by Chrome/iOS extensions messaging:
// "A listener indicated an asynchronous response by returning true, but the message channel closed..."
(function(){
  const EXT_MSG = "A listener indicated an asynchronous response by returning true, but the message channel closed";
  window.addEventListener("unhandledrejection", function(e){
    try{
      const r = e && e.reason;
      const msg = (typeof r === "string") ? r : (r && r.message) ? r.message : "";
      if(msg && msg.indexOf(EXT_MSG) !== -1){
        e.preventDefault();
        // keep it quiet (optional): console.warn("[Ignored extension message noise]", msg);
      }
    }catch(_){}
  });
  window.addEventListener("error", function(e){
    try{
      const msg = (e && e.message) ? e.message : "";
      if(msg && msg.indexOf(EXT_MSG) !== -1){
        e.preventDefault && e.preventDefault();
        return true;
      }
    }catch(_){}
    return false;
  });
})();

// ===== GLOBAL SAFE TRANSLATOR (AVAILABLE IMMEDIATELY) =====
window.T = window.T || function(key){
  try{
    var lang = (localStorage.getItem("dl_lang") || "ar");
    var dict = (window.I18N && window.I18N[lang]) ? window.I18N[lang] : null;
    if(dict && Object.prototype.hasOwnProperty.call(dict, key)) return dict[key];
    // fallback to Arabic if exists
    var ar = (window.I18N && window.I18N.ar) ? window.I18N.ar : null;
    if(ar && Object.prototype.hasOwnProperty.call(ar, key)) return ar[key];
    return key;
  }catch(e){
    return key;
  }
};
// Backward-compat (some parts may still call t()/tr())
window.tr = window.tr || window.T;
window.t  = window.t  || window.T;

    const ADMIN_PIN = "1510"; // ØºÙŠØ±Ù‡ Ù„Ùˆ Ø­Ø§Ø¨Ø¨

    let isAdmin = false;
    let matchesLogVisible = false;  // Ù‚Ù„Ù†Ø§ Ù†Ø®Ù„ÙŠÙ‡ Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
    let playersListVisible = false; // Ø¬Ø¯ÙŠØ¯: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
    let db = null;

    let state = {
      players: [], // {id, name, avatar}
      matches: []  // {id, date, winners, losers, createdAt}
    };


// ===== UI Settings: Theme + Language =====
const I18N = {
  ar: {

    // Header
    pagetitle: "Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡",
    headerTitle: "Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ - ",
    subtitleRule: "ÙƒÙ„ Ù…Ø§ØªØ´ = Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† +1 Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ / Ø§Ù„Ø®Ø³Ø±Ø§Ù† -1 Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨",
    darkMode: "ğŸŒ™ Dark Mode",
    lightMode: "â˜€ï¸ Light Mode",
    languageLabel: "Ø§Ù„Ù„ØºØ©:",
    // Sections
    playersSectionTitle: "ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†",
    matchSectionTitle: "ğŸ§® ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø§ØªØ´ (Ø¹Ø´Ø±Ø© ÙƒØ§Ù…Ù„Ø©)",
    leaderboardSectionTitle: "ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©",
    championsSectionTitle: "ğŸ… Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ (Ø´Ù‡Ø±ÙŠ)",
    matchesLogSectionTitle: "ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª (ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª)",
    playerAnalysisSectionTitle: "ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ù†ÙØ±Ø¯",
    h2hPlayersTitle: "âš”ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†",
    h2hTeamsTitle: "ğŸ§© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† ÙØ±Ù‚ (2 Ø¶Ø¯ 2)",
    adminSectionTitle: "ğŸ” ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
    notesSectionTitle: "â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",

    // Player management
    newPlayerName: "Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
    newPlayerNamePh: "Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ØŒ Ø¹Ù„ÙŠØŒ Ø­Ø³Ø§Ù…...",
    playerAvatar: "ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    addPlayer: "â• Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨",
    showPlayersList: "ğŸ‘¥ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†",
    hidePlayersList: "ğŸ‘¥ Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†",
    playersListEditHint: "ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù‘Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ ØªØ¶ÙŠÙ/ØªØºÙŠÙ‘Ø± ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·).",
    playersTableNum: "#",
    playersTablePlayer: "Ø§Ù„Ù„Ø§Ø¹Ø¨",
    playersTableActions: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
    statusActive: "Ù†Ø´Ø·",
    statusBanned: "Ù…Ø­Ø¸ÙˆØ±",
    editName: "âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…",
    avatarBtn: "ğŸ–¼ ØµÙˆØ±Ø©",
    banBtn: "â›” Ø­Ø¸Ø±",
    unbanBtn: "âœ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø±",
    deleteBtn: "ğŸ—‘ Ø­Ø°Ù",
    noneDash: "-",
    noPlayersYet: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. Ø£Ø¶ÙÙ Ø¨Ø¹Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹.",
    noPlayersYetShort: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.",

    // Match entry
    matchDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø§ØªØ´",
    matchDateHint: "Ù„Ùˆ ØªØ±ÙƒØªÙ‡ ÙØ§Ø¶ÙŠØŒ Ù‡ÙŠØªØ³Ø¬Ù„ Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…",
    winnerTeamP1: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† - Ù„Ø§Ø¹Ø¨ 1",
    winnerTeamP2: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù† - Ù„Ø§Ø¹Ø¨ 2",
    loserTeamP1: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù† - Ù„Ø§Ø¹Ø¨ 1",
    loserTeamP2: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù† - Ù„Ø§Ø¹Ø¨ 2",
    saveMatch: "âœ… Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø§ØªØ´",
    bonusUnavailable: "ğŸ Ø¨ÙˆÙ†Øµ (ØºÙŠØ± Ù…ØªØ§Ø­)",
    bonusAdd: "ğŸ Ø¥Ø¶Ø§ÙØ© Ø¨ÙˆÙ†Øµ",
    bonusEnabled: "ğŸ Ø¨ÙˆÙ†Øµ Ù…ÙÙØ¹Ù‘Ù„",
    matchNote: "Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø§ ÙŠÙ†ÙØ¹Ø´ ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø§ØªØ´.",
    selectPlayer: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨...",

    // Filters + leaderboard
    year: "Ø§Ù„Ø³Ù†Ø©",
    month: "Ø§Ù„Ø´Ù‡Ø±",
    allYears: "ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª",
    allMonths: "ÙƒÙ„ Ø§Ù„Ø´Ù‡ÙˆØ±",
    detailedView: "ğŸ“Š Ø¹Ø±Ø¶ ØªÙØµÙŠÙ„ÙŠ",
    compactView: "ğŸ“Š Ø¹Ø±Ø¶ Ù…Ø®ØªØµØ±",
    rank: "Ø§Ù„ØªØ±ØªÙŠØ¨",
    player: "Ø§Ù„Ù„Ø§Ø¹Ø¨",
    points: "Ø§Ù„Ù†Ù‚Ø§Ø·",
    bonus: "Ø¨ÙˆÙ†Øµ",
    wins: "ÙÙˆØ²",
    losses: "Ø®Ø³Ø§Ø±Ø©",
    matches: "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª",
    winRate: "% Ø§Ù„ÙÙˆØ²",
    w2: "Ø«Ù†Ø§Ø¦ÙŠØ© Ù",
    w3: "Ø«Ù„Ø§Ø«ÙŠØ© Ù",
    w4: "Ø±Ø¨Ø§Ø¹ÙŠØ© Ù",
    l2: "Ø«Ù†Ø§Ø¦ÙŠØ© Ø®",
    l3: "Ø«Ù„Ø§Ø«ÙŠØ© Ø®",
    l4: "Ø±Ø¨Ø§Ø¹ÙŠØ© Ø®",

    // Champions log
    championsLogHint: "Ø§Ø®ØªØ± Ø³Ù†Ø© Ù…Ø­Ø¯Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø´Ù‡ÙˆØ± (Ù…Ø«Ù„ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ).",
    noCompletedMonths: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ù‡ÙˆØ± Ù…ÙƒØªÙ…Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.",
    noCompletedMonthsInYear: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ù‡ÙˆØ± Ù…ÙƒØªÙ…Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø© Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„.",
    championsLogTitleTpl: "Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ù„Ø³Ù†Ø© {year} â€” ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©",
    first: "Ø§Ù„Ø£ÙˆÙ„",
    second: "Ø§Ù„Ø«Ø§Ù†ÙŠ",
    third: "Ø§Ù„Ø«Ø§Ù„Ø«",
    bestRank: "Ø£ÙØ¶Ù„ Ù…Ø±ÙƒØ²",
    worstRank: "Ø£Ø³ÙˆØ£ Ù…Ø±ÙƒØ²",
    lastYearChampion: "ğŸ† Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø³Ù†Ø©",
    lastMonthChampion: "ğŸ… Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø´Ù‡Ø±",
    selectPlayerAnalysis: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„Ù‡.",

    // Matches log
    showLog: "ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„",
    hideLog: "ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„",
    matchesLogIntro: "Ø£Ø­Ø¯Ø« Ù…Ø§ØªØ´ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø£ÙŠ Ù…Ø§ØªØ´ ØºÙ„Ø· Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚ÙŠ.",
    date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
    winningTeam: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒØ³Ø¨Ø§Ù†",
    losingTeam: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø®Ø³Ø±Ø§Ù†",
    delete: "Ø­Ø°Ù",

    // Player analysis
    choosePlayer: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨",
    choosePlayerOption: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨...",
    playerDetailsHelp: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„Ù‡.",
    totalWins: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    totalLosses: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    totalMatches: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    winRatePeriod: "Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    bonusPlus: "Ø¨ÙˆÙ†Øµ + (Ù…ÙƒØ³Ø¨)",
    bonusMinus: "Ø¨ÙˆÙ†Øµ âˆ’ (Ø®Ø³Ø§Ø±Ø©)",
    bonusNet: "ØµØ§ÙÙŠ Ø§Ù„Ø¨ÙˆÙ†Øµ",

    // H2H
    firstPlayer: "Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„",
    secondPlayer: "Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ",
    analyze: "ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©",
    h2hHelp: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ· \"ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©\".",
    team1p1: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ - Ù„Ø§Ø¹Ø¨ 1",
    team1p2: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ - Ù„Ø§Ø¹Ø¨ 2",
    team2p1: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ù„Ø§Ø¹Ø¨ 1",
    team2p2: "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ù„Ø§Ø¹Ø¨ 2",
    h2hTeamsHelp: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† Ø«Ù… Ø§Ø¶ØºØ· \"ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©\".",

    // Admin
    enableAdmin: "ğŸ”‘ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±",
    disableAdmin: "ğŸšª Ù‚ÙÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±",
    adminViewOnly: "ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙ‚Ø·: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯ÙŠØ±.",
    adminEnabled: "ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù…ÙÙØ¹Ù‘Ù„: Ù…Ø³Ù…ÙˆØ­ Ø¨Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØªØ³Ø¬ÙŠÙ„/Ø­Ø°Ù Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙˆÙ…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
    dataAdminTitle: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)",
    resetAll: "ğŸ§¨ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
    backupSoon: "ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ù‚Ø±ÙŠØ¨Ù‹Ø§)",
    importSoon: "ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±ÙŠØ¨Ù‹Ø§)",
    exportSoon: "ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±ÙŠØ¨Ù‹Ø§)",
    resetWarning1: "Ø²Ø± Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø­Ø°Ø± Ø´Ø¯ÙŠØ¯).",
    resetWarning2: "Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ ÙˆÙ‡Ù†ÙØ¹Ù‘Ù„Ù‡Ø§ Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø¶Ø¨Ø· Ù…Ù†Ø·Ù‚ Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
    
    // Player analysis
    totalWinsPeriod: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    totalLossesPeriod: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    totalMatchesPeriod: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
    bonusPlusLabel: "Ø¨ÙˆÙ†Øµ + (Ù…ÙƒØ³Ø¨)",
    bonusMinusLabel: "Ø¨ÙˆÙ†Øµ âˆ’ (Ø®Ø³Ø§Ø±Ø©)",
    bonusNetLabel: "ØµØ§ÙÙŠ Ø§Ù„Ø¨ÙˆÙ†Øµ",
    daysWin2: "Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ Ù…Ø±ØªÙŠÙ†",
    daysWin3: "Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ 3 Ù…Ø±Ø§Øª",
    daysWin4plus: "Ø£ÙŠØ§Ù… ÙƒØ³Ø¨ ÙÙŠÙ‡Ø§ 4 Ù…Ø±Ø§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±",
    daysLose2: "Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ Ù…Ø±ØªÙŠÙ†",
    daysLose3: "Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ 3 Ù…Ø±Ø§Øª",
    daysLose4plus: "Ø£ÙŠØ§Ù… Ø®Ø³Ø± ÙÙŠÙ‡Ø§ 4 Ù…Ø±Ø§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±",
    playerAnalysisTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ {name} ({period})",
    playerBannedInPeriodTpl: "Ø§Ù„Ù„Ø§Ø¹Ø¨ \"{name}\" Ù…Ø­Ø¸ÙˆØ± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© Ø­Ø³Ø¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙÙ„ØªØ±.",
    playerDaysAnalysisTitle: "ğŸ“† ØªØ­Ù„ÙŠÙ„ Ø£ÙŠØ§Ù… Ø§Ù„ÙÙˆØ² ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",
    playerBestMateTitle: "ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©",
    bestMateWinLabel: "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ù…Ø¹Ø§Ù‡",
    bestMateLoseLabel: "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Ù‘Øª Ù…Ø¹Ø§Ù‡",
    playerBestOppTitle: "ğŸ‘Š Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©",
    bestOppWinLabel: "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ø¶Ø¯Ù‡",
    bestOppLoseLabel: "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Øª Ø¶Ø¯Ù‡",
    countTimesLabel: "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:",

    // Champions extra
    lastYearChampionLabel: "ğŸ† Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø§Ø®Ø± Ø³Ù†Ø©",
    lastMonthChampionLabel: "ğŸ… Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø§Ø®Ø± Ø´Ù‡Ø±",

    // Head-to-head (1v1)
    h2hReportTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨ÙŠÙ† {p1} and {p2} ({period}):<br/><br/>",
    h2hPlayedAgainstTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
    h2hP1BeatP2Tpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {p1} Ø¹Ù„Ù‰ {p2}: {n} Ù…Ø±Ø©.<br/>",
    h2hP2BeatP1Tpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {p2} Ø¹Ù„Ù‰ {p1}: {n} Ù…Ø±Ø©.<br/>",
    h2hPlayedSameTeamTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ù…Ø¹Ù‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
    h2hWinRateVsTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ‚Ø§Ø¨Ù„Ø§Ù† Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>",
    h2hSameTeamRateTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ„Ø¹Ø¨Ø§Ù† Ù…Ø¹Ù‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>",
    h2hSameTeamWinTpl: "â€¢ ÙÙˆØ² Ù…Ø¹Ù‹Ø§: {rate} ({wins} Ù…Ù† {total} Ù…Ø§ØªØ´Ø§Øª)<br/>",
    h2hSameTeamLoseTpl: "â€¢ Ø®Ø³Ø§Ø±Ø© Ù…Ø¹Ù‹Ø§: {rate} ({losses} Ù…Ù† {total} Ù…Ø§ØªØ´Ø§Øª)<br/>",
    h2hBonusTitle: "<br/><b>ğŸ Ø§Ù„Ø¨ÙˆÙ†Øµ (Ù…Ø­Ø³ÙˆØ¨ Ù…Ù†ÙØµÙ„)</b><br/>",
    h2hBaseTitle: "<br/><b>ğŸ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø¨ÙˆÙ†Øµ)</b><br/>",
    h2hP1GotBonusFromP2Tpl: "â€¢ Ø­ØµÙ„ {p1} Ù…Ù† {p2} Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
    h2hP2GotBonusFromP1Tpl: "â€¢ Ø­ØµÙ„ {p2} Ù…Ù† {p1} Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
    h2hP1GotBaseFromP2Tpl: "â€¢ Ø­ØµÙ„ {p1} Ù…Ù† {p2} Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",
    h2hP2GotBaseFromP1Tpl: "â€¢ Ø­ØµÙ„ {p2} Ù…Ù† {p1} Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",

    // Head-to-head (2v2 teams)
    h2hTeamsReportTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ {t1} ÙˆØ§Ù„ÙØ±ÙŠÙ‚ {t2} ({period}):<br/><br/>",
    h2hTeamsPlayedAgainstTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
    h2hTeamsT1WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t1}: {n} Ù…Ø±Ø©.<br/>",
    h2hTeamsT2WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t2}: {n} Ù…Ø±Ø©.<br/>",
    h2hTeamsWinRateTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ‚Ø§Ø¨Ù„Ø§Ù† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>",
    h2hNoVsTpl: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† <strong>{p1}</strong> and <strong>{p2}</strong> ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© ({period}).",
    h2hTeamsNoVsTpl: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† <strong>{t1}</strong> and <strong>{t2}</strong> ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© ({period}).",

    // Player analysis
    totalWinsPeriod: "Total wins in selected period",
    totalLossesPeriod: "Total losses in selected period",
    totalMatchesPeriod: "Total matches in selected period",
    bonusPlusLabel: "Bonus + (win)",
    bonusMinusLabel: "Bonus âˆ’ (loss)",
    bonusNetLabel: "Net bonus",
    playerDaysAnalysisTitle: "ğŸ“† Win/Loss days analysis in selected period",
    playerBestMateTitle: "ğŸ¤ Best teammate in the same period",
    bestMateWinLabel: "Most wins with",
    bestMateLoseLabel: "Most losses with",
    playerBestOppTitle: "ğŸ‘Š Favorite opponent in the same period",
    bestOppWinLabel: "Most wins against",
    bestOppLoseLabel: "Most losses against",
    countTimesLabel: "Times:",

    // Champions extra
    lastYearChampionLabel: "ğŸ† Last year champion",
    lastMonthChampionLabel: "ğŸ… Last month champion",

    // Head-to-head (1v1)
    h2hReportTitleTpl: "Head-to-head analysis between {p1} and {p2} ({period}):<br/><br/>",
    h2hPlayedAgainstTpl: "â€¢ Played against each other in {n} full-ten match(es).<br/>",
    h2hP1BeatP2Tpl: "â€¢ {p1} beat {p2}: {n} time(s).<br/>",
    h2hP2BeatP1Tpl: "â€¢ {p2} beat {p1}: {n} time(s).<br/>",
    h2hPlayedSameTeamTpl: "â€¢ Played together on the same team in {n} full-ten match(es).<br/>",
    h2hWinRateVsTitle: "<br/>Win rate when they face each other in this period:<br/>",
    h2hSameTeamRateTitle: "<br/>Results when they play on the same team in this period:<br/>",
    h2hSameTeamWinTpl: "â€¢ Win together: {rate} ({wins} of {total} matches)<br/>",
    h2hSameTeamLoseTpl: "â€¢ Lose together: {rate} ({losses} of {total} matches)<br/>",
    h2hBonusTitle: "<br/><b>ğŸ Bonus (calculated separately)</b><br/>",
    h2hBaseTitle: "<br/><b>ğŸ¯ Base points (without bonus)</b><br/>",
    h2hP1GotBonusFromP2Tpl: "â€¢ Ø­ØµÙ„ {p1} Ù…Ù† {p2} Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
    h2hP2GotBonusFromP1Tpl: "â€¢ Ø­ØµÙ„ {p2} Ù…Ù† {p1} Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
    h2hP1GotBaseFromP2Tpl: "â€¢ Ø­ØµÙ„ {p1} Ù…Ù† {p2} Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",
    h2hP2GotBaseFromP1Tpl: "â€¢ Ø­ØµÙ„ {p2} Ù…Ù† {p1} Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",

    // Head-to-head (2v2 teams)
    h2hTeamsReportTitleTpl: "Head-to-head analysis between Team {t1} and Team {t2} ({period}):<br/><br/>",
    h2hTeamsPlayedAgainstTpl: "â€¢ Played against each other in {n} full-ten match(es).<br/>",
    h2hTeamsT1WinsTpl: "â€¢ {t1} wins: {n}.<br/>",
    h2hTeamsT2WinsTpl: "â€¢ {t2} wins: {n}.<br/>",
    h2hTeamsWinRateTitle: "<br/>Win rate when they face each other in this period:<br/>",
    h2hNoVsTpl: "No direct head-to-head matches between <strong>{p1}</strong> and <strong>{p2}</strong> in this period ({period}).",
    h2hTeamsNoVsTpl: "No direct head-to-head matches between <strong>{t1}</strong> and <strong>{t2}</strong> in this period ({period}).",
// Extra / Missing translations
    registeredPlayers: "Registered Players",
    notEnoughDataForYear: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©.",
    confirmUnbanPlayer: "ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨",
    confirmBanPlayer: "Ø­Ø¸Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨",
    banExplanation: "Ù„Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ù…Ù† Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø¸Ø± Ø­ØªÙ‰ ÙÙƒ Ø§Ù„Ø­Ø¸Ø±.\n\nØ³ÙŠØ®ØªÙÙŠ Ø£ÙŠØ¶Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯Ù…Ø§ ØªÙ‚Ø¹ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¯Ø§Ø®Ù„ ÙØªØ±Ø© Ø§Ù„Ø­Ø¸Ø±.",
    errAddPlayer: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨.",
    errUpdateAvatar: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨.",
    errEditPlayerName: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨.",
    errDeleteMatch: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø§ØªØ´.",
    errSaveMatch: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø§ØªØ´.",
    errResetData: "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
    confirmDeleteMatch: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø§ØªØ´ØŸ",
    confirmResetAll: "Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù…ØªØ£ÙƒØ¯ØŸ",
    samePlayerNotAllowed: "Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙƒØ§Ù†.",
    chooseTwoPlayersFirst: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹.",
    chooseTeamsPlayersFirst: "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚ Ø£ÙˆÙ„Ù‹Ø§.",
    selectAllPlayers: "Ø§Ø®ØªØ± ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.",
    playerNotFound: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.",
    noDate: "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®",
    unknown: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
    completedMonth: "Ø´Ù‡Ø± Ù…ÙƒØªÙ…Ù„",
    completed: "Ø§Ù„Ù…ÙƒØªÙ…Ù„",
    streak: "Ø³ØªØ±ÙŠÙƒ",
    selectedRangeEnd: "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",


    enterPlayerNameFirst: "Enter the player name first.",
    promptNewPlayerName: "Enter the new player name:",
    nameCannotBeEmpty: "Name cannot be empty.",
    needAtLeast4Players: "At least 4 players are required.",
    samePlayerSelectedTwice: "You cannot select the same player twice.",
    noMatchesInPeriod: "No matches recorded in this period.",
    noResultsInPeriod: "No results yet in this period.",
    idPrefix: "ID",
    periodMonthYearTpl: "Period: {month} {year}",
    periodYearTpl: "Period: Year {year}",
    periodMonthAllYearsTpl: "Period: {month} (all years)",
    periodAllTime: "Period: All time",
    playerIdNotFound: "No player found with this ID.",
    samePlayerSameTeam: "A player cannot occupy both Player 1 and Player 2 in the same team.",
    samePlayerBothTeams: "A player cannot be on both teams in the same matchup.",
    cannotCompareSameTeam: "You cannot compare a team against itself.",
    enterPlayerNameFirst: "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£ÙˆÙ„Ø§Ù‹.",
    promptNewPlayerName: "Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù„Ø§Ø¹Ø¨:",
    nameCannotBeEmpty: "Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±Øº.",
    needAtLeast4Players: "Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 4 Ù„Ø§Ø¹Ø¨ÙŠÙ†.",
    samePlayerSelectedTwice: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø±ØªÙŠÙ†.",
    noMatchesInPeriod: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ø§ØªØ´Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.",
    noResultsInPeriod: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.",
    idPrefix: "ID",
    periodMonthYearTpl: "Ø§Ù„ÙØªØ±Ø©: {month} {year}",
    periodYearTpl: "Ø§Ù„ÙØªØ±Ø©: Ø³Ù†Ø© {year}",
    periodMonthAllYearsTpl: "Ø§Ù„ÙØªØ±Ø©: Ø´Ù‡Ø± {month} ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª.",
    periodAllTime: "Ø§Ù„ÙØªØ±Ø©: ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª.",
    playerIdNotFound: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù.",
    samePlayerSameTeam: "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…ÙƒØ§Ù† Ù„Ø§Ø¹Ø¨ 1 and 2 ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚.",
    samePlayerBothTeams: "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙ„Ø¹Ø¨ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©.",
    cannotCompareSameTeam: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†ÙØ³Ù‡.",
    // Extra / Missing translations
    registeredPlayers: "Registered Players",
    notEnoughDataForYear: "Not enough data for this year.",
    confirmUnbanPlayer: "Unban player",
    confirmBanPlayer: "Ban player",
    banExplanation: "They will not appear in match entry from the moment of ban until unbanned.\n\nThey will also be hidden from analytics when the selected range end falls within the ban period.",
    errAddPlayer: "An error occurred while adding the player.",
    errUpdateAvatar: "An error occurred while updating the player photo.",
    errEditPlayerName: "An error occurred while editing the player name.",
    errDeleteMatch: "An error occurred while deleting the match.",
    errSaveMatch: "An error occurred while saving the match.",
    errResetData: "An error occurred while resetting the data.",
    confirmDeleteMatch: "Are you sure you want to delete this match?",
    confirmResetAll: "This will permanently delete all players and results from the database. Are you sure?",
    samePlayerNotAllowed: "The same player cannot be selected in more than one place.",
    chooseTwoPlayersFirst: "Choose two players first.",
    chooseTeamsPlayersFirst: "Choose both teams' players first.",
    selectAllPlayers: "Select all players.",
    playerNotFound: "One of the players was not found.",
    noDate: "No date",
    unknown: "Unknown",
    completedMonth: "Completed month",
    completed: "Completed",
    streak: "Streak",
    selectedRangeEnd: "Selected range end",



    // Notes
    note1: "Ù…Ù† ØºÙŠØ± ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±ØŒ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙ‚Ø·.",
    note2: "ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙŠ Firebase FirestoreØŒ ØªÙ‚Ø¯Ø± ØªÙØªØ­ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø².",
    note3: "Ø§Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø± Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙØªØ±Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„ØªÙ€Ø±ØªÙŠØ¨ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª.",
    // H2H (by names)
    receivedBonusByNamesTpl: "â€¢ Ø­ØµÙ„ {to} Ù…Ù† {from} Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
    receivedPointsByNamesTpl: "â€¢ Ø­ØµÙ„ {to} Ù…Ù† {from} Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",

  },
  en: {

    // Header
    pagetitle: "Friendly League",
    headerTitle: "Friendly League",
    subtitleRule: "Each match = Winning team +1 per player / Losing team -1 per player",
    darkMode: "ğŸŒ™ Dark Mode",
    lightMode: "â˜€ï¸ Light Mode",
    languageLabel: "Language:",
    // Sections
    playersSectionTitle: "ğŸ‘¤ Player Management",
    matchSectionTitle: "ğŸ§® Record a Match Result (Full Ten)",
    leaderboardSectionTitle: "ğŸ† Leaderboard & Overall Stats",
    championsSectionTitle: "ğŸ… Champions Log (Monthly)",
    matchesLogSectionTitle: "ğŸ“œ Matches Log (All Time)",
    playerAnalysisSectionTitle: "ğŸ“Š Single Player Analysis",
    h2hPlayersTitle: "âš”ï¸ Head-to-Head (Player vs Player)",
    h2hTeamsTitle: "ğŸ§© Head-to-Head (2 vs 2 Teams)",
    adminSectionTitle: "ğŸ” Admin Mode & Advanced Management",
    notesSectionTitle: "â„¹ï¸ Usage Notes",

    // Player management
    newPlayerName: "New Player Name",
    newPlayerNamePh: "Example: Ahmed, Ali, Hossam...",
    playerAvatar: "Player Photo (optional)",
    addPlayer: "â• Add Player",
    showPlayersList: "ğŸ‘¥ Show Players List",
    hidePlayersList: "ğŸ‘¥ Hide Players List",
    playersListEditHint: "You can edit the player name or add/change the player photo from the table (admin only).",
    playersTableNum: "#",
    playersTablePlayer: "Player",
    playersTableActions: "Actions",
    statusActive: "Active",
    statusBanned: "Banned",
    editName: "âœï¸ Edit Name",
    avatarBtn: "ğŸ–¼ Photo",
    banBtn: "â›” Ban",
    unbanBtn: "âœ… Unban",
    deleteBtn: "ğŸ—‘ Delete",
    noneDash: "-",
    noPlayersYet: "No players yet. Add some players first.",
    noPlayersYetShort: "No players yet.",

    // Match entry
    matchDate: "Match Date",
    matchDateHint: "If left empty, it will be saved as today's date",
    winnerTeamP1: "Winning Team - Player 1",
    winnerTeamP2: "Winning Team - Player 2",
    loserTeamP1: "Losing Team - Player 1",
    loserTeamP2: "Losing Team - Player 2",
    saveMatch: "âœ… Save Match Result",
    bonusUnavailable: "ğŸ Bonus (Unavailable)",
    bonusAdd: "ğŸ Add Bonus",
    bonusEnabled: "ğŸ Bonus Enabled",
    matchNote: "Note: The same player cannot be in both teams in the same match.",
    selectPlayer: "Select player...",

    // Filters + leaderboard
    year: "Year",
    month: "Month",
    allYears: "All years",
    allMonths: "All months",
    detailedView: "ğŸ“Š Detailed View",
    compactView: "ğŸ“Š Compact View",
    rank: "Rank",
    player: "Player",
    points: "Points",
    bonus: "Bonus",
    wins: "Wins",
    losses: "Losses",
    matches: "Matches",
    winRate: "Win Rate %",
    w2: "2 Wins",
    w3: "3 Wins",
    w4: "4+ Wins",
    l2: "2 Losses",
    l3: "3 Losses",
    l4: "4+ Losses",

    // Champions log
    championsLogHint: "Select a specific year to view monthly champions (like a league record).",
    noCompletedMonths: "No completed months in the selected period.",
    noCompletedMonthsInYear: "No completed months in this year to display the champions log.",
    championsLogTitleTpl: "Champions Log for {year} â€” click headers to sort",
    first: "1st",
    second: "2nd",
    third: "3rd",
    bestRank: "Best Rank",
    worstRank: "Worst Rank",
    lastYearChampion: "ğŸ† Last Year Champion",
    lastMonthChampion: "ğŸ… Last Month Champion",
    selectPlayerAnalysis: "Select a player to view their analysis.",

    // Matches log
    showLog: "ğŸ‘ï¸ Show Log",
    hideLog: "ğŸ‘ï¸ Hide Log",
    matchesLogIntro: "Latest match on top. You can delete any wrong match without affecting the others.",
    date: "Date",
    winningTeam: "Winning Team",
    losingTeam: "Losing Team",
    delete: "Delete",

    // Player analysis
    choosePlayer: "Choose Player",
    playerDetailsHelp: "Choose a player from the list to view their analysis.",
    totalWinsPeriod: "Total wins in selected period",
    totalLossesPeriod: "Total losses in selected period",
    totalMatchesPeriod: "Total matches in selected period",
    bonusPlusLabel: "Bonus + (win)",
    bonusMinusLabel: "Bonus âˆ’ (loss)",
    bonusNetLabel: "Net bonus",
    daysWin2: "Days won exactly 2 times",
    daysWin3: "Days won exactly 3 times",
    daysWin4plus: "Days won 4+ times",
    daysLose2: "Days lost exactly 2 times",
    daysLose3: "Days lost exactly 3 times",
    daysLose4plus: "Days lost 4+ times",
    playerAnalysisTitleTpl: "Player analysis for {name} ({period})",
    playerBannedInPeriodTpl: "Player \"{name}\" is banned in this period based on the filter end date.",
    totalWins: "Total wins in the selected period",
    totalLosses: "Total losses in the selected period",
    totalMatches: "Total matches in the selected period",
    winRatePeriod: "Win rate in the selected period",
    bonusPlus: "Bonus + (Win)",
    bonusMinus: "Bonus âˆ’ (Loss)",
    bonusNet: "Net bonus",

    // H2H
    firstPlayer: "Player 1",
    secondPlayer: "Player 2",
    analyze: "ğŸ” Analyze",
    h2hHelp: "Choose two players then click \"Analyze\".",
    team1p1: "Team 1 - Player 1",
    team1p2: "Team 1 - Player 2",
    team2p1: "Team 2 - Player 1",
    team2p2: "Team 2 - Player 2",
    h2hTeamsHelp: "Choose both teams then click \"Analyze\".",

    // Admin
    enableAdmin: "ğŸ”‘ Enable Admin Mode",
    disableAdmin: "ğŸšª Disable Admin Mode",
    adminViewOnly: "View-only mode: data cannot be edited unless admin PIN is entered.",
    adminEnabled: "Admin mode enabled: you can add players, add/delete matches, and reset data.",
    dataAdminTitle: "Data Management (Admin only)",
    resetAll: "ğŸ§¨ Reset All Data",
    backupSoon: "ğŸ’¾ Backup (Soon)",
    importSoon: "ğŸ“¥ Import (Soon)",
    exportSoon: "ğŸ“¤ Export (Soon)",
    resetWarning1: "Reset All Data deletes all players and all matches permanently from the database (use with extreme caution).",
    resetWarning2: "Backup/Import/Export buttons are currently disabled and will be enabled after implementing reliable save/restore logic.",
    // Player analysis (best mate / opponent)
    playerBestMateTitle: "ğŸ¤ Best teammate in the same period",
    bestMateWinLabel: "Most wins with",
    bestMateLoseLabel: "Most losses with",
    playerBestOppTitle: "ğŸ‘Š Favorite opponent in the same period",
    bestOppWinLabel: "Most wins against",
    bestOppLoseLabel: "Most losses against",
    countTimesLabel: "Times:",
    h2hTeamsReportTitleTpl: "Head-to-head analysis between Team {t1} and Team {t2} ({period}):<br/><br/>",

    h2hTeamsPlayedAgainstTpl: "â€¢ Played against each other in {n} full-ten match(es).<br/>",

    h2hTeamsT1WinsTpl: "â€¢ {t1} wins: {n}.<br/>",

    h2hTeamsT2WinsTpl: "â€¢ {t2} wins: {n}.<br/>",

    h2hTeamsWinRateTitle: "<br/>Win rate when they face each other in this period:<br/>",



    // Notes
    note1: "Without admin mode, the app is view-only.",
    note2: "All data is stored online in Firebase Firestore; you can open it from any device.",
    note3: "Use the Year/Month filters to control the stats period for leaderboard, analysis, and head-to-head.",
    // H2H (by names)
    receivedBonusByNamesTpl: "â€¢ {to} received bonus from {from}: {n}<br/>",
    receivedPointsByNamesTpl: "â€¢ {to} received points from {from}: {n}<br/>",

  }
};
// expose i18n to global translator
window.I18N = I18N;

// ===== I18N_OVERRIDE_PATCH (fix duplicated/mixed keys) =====
(function(){
  try{
    if(!window.I18N) return;
    // Force Arabic templates (some files had duplicated keys overriding Arabic with English)
    Object.assign(window.I18N.ar, {
      periodMonthYearTpl: "Ø§Ù„ÙØªØ±Ø©: {month} {year}",
      periodYearTpl: "Ø§Ù„ÙØªØ±Ø©: Ø³Ù†Ø© {year}",
      periodMonthAllYearsTpl: "Ø§Ù„ÙØªØ±Ø©: Ø´Ù‡Ø± {month} ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª.",
      periodAllTime: "Ø§Ù„ÙØªØ±Ø©: ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª.",
      lastYearChampionLabel: "ğŸ† Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø³Ù†Ø©",
      lastMonthChampionLabel: "ğŸ… Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø´Ù‡Ø±",
      h2hTeamsReportTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ {t1} ÙˆØ§Ù„ÙØ±ÙŠÙ‚ {t2} ({period}):<br/><br/>",
      h2hTeamsPlayedAgainstTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
      h2hTeamsT1WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t1}: {n} Ù…Ø±Ø©.<br/>",
      h2hTeamsT2WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t2}: {n} Ù…Ø±Ø©.<br/>",
      h2hTeamsWinRateTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ‚Ø§Ø¨Ù„Ø§Ù† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>"
    });
  
    // Hotfix: ensure EN has all required keys (some older edits removed them)
    Object.assign(window.I18N.en, {
      playerDaysAnalysisTitle: "ğŸ“† Win/Loss days analysis in the selected period",
      lastYearChampionLabel: "ğŸ† Last year champion",
      lastMonthChampionLabel: "ğŸ… Last month champion",

      h2hReportTitleTpl: "Head-to-head analysis between {p1} and {p2} ({period}):<br/><br/>",
      h2hPlayedAgainstTpl: "â€¢ Played against each other in {n} full-ten match(es).<br/>",
      h2hP1BeatP2Tpl: "â€¢ {p1} beat {p2}: {n} time(s).<br/>",
      h2hP2BeatP1Tpl: "â€¢ {p2} beat {p1}: {n} time(s).<br/>",
      h2hPlayedTogetherTpl: "â€¢ Played together on the same team in {n} full-ten match(es).<br/><br/>",

      h2hWinRateTitle: "<strong>Win rate when they face each other in this period:</strong><br/>",
      h2hBonusTitle: "<strong>ğŸ Bonus (calculated separately)</strong><br/>",
      h2hBasePointsTitle: "<strong>ğŸ¯ Base points (without bonus)</strong><br/>",

      receivedBonusByNamesTpl: "â€¢ {to} received bonus from {from}: {n}<br/>",
      receivedPointsByNamesTpl: "â€¢ {to} received points from {from}: {n}<br/>",

      h2hTeamsReportTitleTpl: "Head-to-head analysis between Team {t1} and Team {t2} ({period}):<br/><br/>",
      h2hTeamsPlayedAgainstTpl: "â€¢ Played against each other in {n} full-ten match(es).<br/>",
      h2hTeam1WinsTpl: "â€¢ {t1} wins: {n}.<br/>",
      h2hTeam2WinsTpl: "â€¢ {t2} wins: {n}.<br/>",
      h2hTeamsWinRateTitle: "<strong>Win rate when they face each other in this period:</strong><br/>"
,
      // Aliases used by current generators (avoid fallback to Arabic)
      h2hPlayedSameTeamTpl: "â€¢ Played together on the same team in {n} full-ten match(es).<br/>",
      h2hWinRateVsTitle: "<br/>Win rate when they face each other in this period:<br/>",
      h2hSameTeamRateTitle: "<br/>Results when they play on the same team in this period:<br/>",
      h2hSameTeamWinTpl: "â€¢ Win together: {rate} ({wins} of {total} matches)<br/>",
      h2hSameTeamLoseTpl: "â€¢ Lose together: {rate} ({losses} of {total} matches)<br/>",
      h2hBaseTitle: "<br/><b>ğŸ¯ Base points (without bonus)</b><br/>",
      // Days analysis labels used in UI
      daysAnalysisTitle: "ğŸ“… Win/Loss days analysis in the selected period",
      daysWonExactly2: "Days won exactly 2 times",
      daysWonExactly3: "Days won exactly 3 times",
      daysWon4Plus: "Days won 4+ times",
      daysLostExactly2: "Days lost exactly 2 times",
      daysLostExactly3: "Days lost exactly 3 times",
      daysLost4Plus: "Days lost 4+ times",
    });}catch(e){}
})();

// ===== I18N Hotfix: ensure Arabic H2H templates are Arabic (avoid duplicate-key override) =====
(function(){
  try{
    if(!window.I18N || !window.I18N.ar) return;
    Object.assign(window.I18N.ar, {
      // Head-to-head (1v1)
      h2hReportTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨ÙŠÙ† {p1} and {p2} ({period}):<br/><br/>",
      h2hPlayedAgainstTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
      h2hP1BeatP2Tpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {p1} Ø¹Ù„Ù‰ {p2}: {n} Ù…Ø±Ø©.<br/>",
      h2hP2BeatP1Tpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {p2} Ø¹Ù„Ù‰ {p1}: {n} Ù…Ø±Ø©.<br/>",
      h2hPlayedSameTeamTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ù…Ø¹Ù‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
      h2hWinRateVsTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ‚Ø§Ø¨Ù„Ø§Ù† Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>",
      h2hSameTeamRateTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ„Ø¹Ø¨Ø§Ù† Ù…Ø¹Ù‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>",
      h2hSameTeamWinTpl: "â€¢ ÙÙˆØ² Ù…Ø¹Ù‹Ø§: {rate} ({wins} Ù…Ù† {total} Ù…Ø§ØªØ´Ø§Øª)<br/>",
      h2hSameTeamLoseTpl: "â€¢ Ø®Ø³Ø§Ø±Ø© Ù…Ø¹Ù‹Ø§: {rate} ({losses} Ù…Ù† {total} Ù…Ø§ØªØ´Ø§Øª)<br/>",
      h2hBonusTitle: "<br/><b>ğŸ Ø§Ù„Ø¨ÙˆÙ†Øµ (Ù…Ø­Ø³ÙˆØ¨ Ù…Ù†ÙØµÙ„)</b><br/>",
      h2hBaseTitle: "<br/><b>ğŸ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø¨ÙˆÙ†Øµ)</b><br/>",
      h2hP1GotBonusFromP2Tpl: "â€¢ Ø­ØµÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 2 Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
      h2hP2GotBonusFromP1Tpl: "â€¢ Ø­ØµÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ 2 Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ: {n}<br/>",
      h2hP1GotBaseFromP2Tpl: "â€¢ Ø­ØµÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 2 Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",
      h2hP2GotBaseFromP1Tpl: "â€¢ Ø­ØµÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ 2 Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·: {n}<br/>",

      // Head-to-head (2v2 teams)
      h2hTeamsReportTitleTpl: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ {t1} ÙˆØ§Ù„ÙØ±ÙŠÙ‚ {t2} ({period}):<br/><br/>",
      h2hTeamsPlayedAgainstTpl: "â€¢ Ù„Ø¹Ø¨ÙˆØ§ Ø¶Ø¯ Ø¨Ø¹Ø¶ ÙÙŠ {n} Ù…Ø§ØªØ´(Ø§Øª) Ø¹Ø´Ø±Ø©.<br/>",
      h2hTeamsT1WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t1}: {n} Ù…Ø±Ø©.<br/>",
      h2hTeamsT2WinsTpl: "â€¢ Ù…Ø±Ø§Øª ÙØ§Ø² ÙÙŠÙ‡Ø§ {t2}: {n} Ù…Ø±Ø©.<br/>",
      h2hTeamsWinRateTitle: "<br/>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ‚Ø§Ø¨Ù„Ø§Ù† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©:<br/>"
    });
  }catch(e){}
})();

// ===== HOTFIX: Ensure Arabic dictionary does not get overridden by stray English duplicates =====
try{
  if(window.I18N && window.I18N.ar){
    Object.assign(window.I18N.ar, {"darkMode": "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ", "lightMode": "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ", "totalWinsPeriod": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©", "totalLossesPeriod": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø±Ø§Øª Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©", "totalMatchesPeriod": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©", "bonusPlusLabel": "Ø¨ÙˆÙ†Øµ + (Ù…ÙƒØ³Ø¨)", "bonusMinusLabel": "Ø¨ÙˆÙ†Øµ âˆ’ (Ø®Ø³Ø§Ø±Ø©)", "bonusNetLabel": "ØµØ§ÙÙŠ Ø§Ù„Ø¨ÙˆÙ†Øµ", "playerDaysAnalysisTitle": "ğŸ“† ØªØ­Ù„ÙŠÙ„ Ø£ÙŠØ§Ù… Ø§Ù„ÙÙˆØ² ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©", "playerBestMateTitle": "ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©", "bestMateWinLabel": "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ù…Ø¹Ø§Ù‡", "bestMateLoseLabel": "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Ù‘Øª Ù…Ø¹Ø§Ù‡", "playerBestOppTitle": "ğŸ‘Š Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ÙØ¶Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©", "bestOppWinLabel": "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ø¶Ø¯Ù‡", "bestOppLoseLabel": "Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø®Ø³Ø±Øª Ø¶Ø¯Ù‡", "countTimesLabel": "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª:", "lastYearChampionLabel": "ğŸ† Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø³Ù†Ø©", "lastMonthChampionLabel": "ğŸ… Ø­Ø§Ù…Ù„ Ù„Ù‚Ø¨ Ø¢Ø®Ø± Ø´Ù‡Ø±", "registeredPlayers": "<span id="registeredPlayersLabel"></span>", "notEnoughDataForYear": "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©.", "confirmUnbanPlayer": "ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨", "confirmBanPlayer": "Ø­Ø¸Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨", "banExplanation": "Ù„Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ù…Ù† Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø¸Ø± Ø­ØªÙ‰ ÙÙƒ Ø§Ù„Ø­Ø¸Ø±.\n\nÙˆØ³ÙŠØ®ØªÙÙŠ Ø£ÙŠØ¶Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯Ù…Ø§ ØªÙ‚Ø¹ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¯Ø§Ø®Ù„ ÙØªØ±Ø© Ø§Ù„Ø­Ø¸Ø±.", "errAddPlayer": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨.", "errUpdateAvatar": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨.", "errEditPlayerName": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨.", "errDeleteMatch": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø§ØªØ´.", "errSaveMatch": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø§ØªØ´.", "errResetData": "Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.", "confirmDeleteMatch": "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø§ØªØ´ØŸ", "confirmResetAll": "Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù…ØªØ£ÙƒØ¯ØŸ", "samePlayerNotAllowed": "Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙƒØ§Ù†.", "chooseTwoPlayersFirst": "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹.", "chooseTeamsPlayersFirst": "Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚ Ø£ÙˆÙ„Ù‹Ø§.", "selectAllPlayers": "Ø§Ø®ØªØ± ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.", "playerNotFound": "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.", "noDate": "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®", "unknown": "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", "completedMonth": "Ø´Ù‡Ø± Ù…ÙƒØªÙ…Ù„", "completed": "Ø§Ù„Ù…ÙƒØªÙ…Ù„", "streak": "Ø³ØªØ±ÙŠÙƒ", "selectedRangeEnd": "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©", "enterPlayerNameFirst": "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", "promptNewPlayerName": "Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù„Ø§Ø¹Ø¨:", "nameCannotBeEmpty": "Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§.", "needAtLeast4Players": "Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 4 Ù„Ø§Ø¹Ø¨ÙŠÙ†.", "samePlayerSelectedTwice": "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø±ØªÙŠÙ†.", "noMatchesInPeriod": "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ø§ØªØ´Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.", "noResultsInPeriod": "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.", "idPrefix": "ID", "periodMonthYearTpl": "Ø§Ù„ÙØªØ±Ø©: {month} {year}", "periodYearTpl": "Ø§Ù„ÙØªØ±Ø©: Ø³Ù†Ø© {year}", "periodMonthAllYearsTpl": "Ø§Ù„ÙØªØ±Ø©: Ø´Ù‡Ø± {month} ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª.", "periodAllTime": "Ø§Ù„ÙØªØ±Ø©: ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª.", "playerIdNotFound": "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù.", "samePlayerSameTeam": "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…ÙƒØ§Ù† Ù„Ø§Ø¹Ø¨ 1 and 2 ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚.", "samePlayerBothTeams": "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙ„Ø¹Ø¨ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©.", "cannotCompareSameTeam": "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†ÙØ³Ù‡."});
  }
}catch(e){}



const MONTHS = {
  ar: ["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"],
  en: ["January","February","March","April","May","June","July","August","September","October","November","December"]
};

function monthName(m){
  const lang = getLang();
  return (MONTHS[lang] || MONTHS.ar)[m-1] || "";
}

function getLang() {
  const ls = localStorage.getItem("dl_lang");
  return (ls === "ar" || ls === "en") ? ls : "ar";
}
function setLang(lang) {
  localStorage.setItem("dl_lang", lang);
  applyLang(lang);

  // Re-render dynamic sections so tables/headers/buttons update immediately
  const fns = [
    "updatePlayersUI",
    "updatePlayerDetailsUI",
    "updateLeaderboard",
    "updateChampionsLog",
    "updateMatchesLog",
    "updateHeadToHeadUI",
    "updateAdminUI",
    "updateFilterYearOptions",
    "updateBonusEligibility"
  ];
  fns.forEach(name=>{
    try{
      if (typeof window[name] === "function") window[name]();
    }catch(e){}
  });
  // Refresh any already-visible H2H reports in the new language
  try{ autoAnalyzeHeadToHeadIfReady && autoAnalyzeHeadToHeadIfReady(true); }catch(e){}
  try{ autoAnalyzeTeamsIfReady && autoAnalyzeTeamsIfReady(true); }catch(e){}
}

function __old_T(key) {
  const lang = getLang();
  return (I18N[lang] && I18N[lang][key]) || (I18N.ar[key] || key);
}

function __old_T(key){
  return T(key);
}


function applyLang(lang) {
  const html = document.documentElement;
  html.lang = lang;
  html.dir = (lang === "ar") ? "rtl" : "ltr";

  // Page title + header
  document.title = T("pagetitle");
  const titleEl = document.getElementById("appTitle");
  if (titleEl) titleEl.textContent = T("headerTitle");

  const sub = document.getElementById("subtitleRule");
  if (sub) sub.textContent = T("subtitleRule");

  const langLabel = document.getElementById("languageLabel");
  if (langLabel) langLabel.textContent = T("languageLabel");

  // Section headings
  const sectionIds = [
    "playersSectionTitle","matchSectionTitle","leaderboardSectionTitle","championsSectionTitle",
    "matchesLogSectionTitle","playerAnalysisSectionTitle","h2hPlayersTitle","h2hTeamsTitle",
    "adminSectionTitle","notesSectionTitle"
  ];
  sectionIds.forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.textContent = T(id);
  });

  // Labels
  const setLabel = (forId, key) => {
    const el = document.querySelector(`label[for="${forId}"]`);
    if (el) el.textContent = T(key);
  };
  setLabel("playerName", "newPlayerName");
  setLabel("playerAvatarFile", "playerAvatar");
  setLabel("matchDate", "matchDate");
  setLabel("winnerP1", "winnerTeamP1");
  setLabel("winnerP2", "winnerTeamP2");
  setLabel("loserP1", "loserTeamP1");
  setLabel("loserP2", "loserTeamP2");
  setLabel("filterYear", "year");
  setLabel("filterMonth", "month");
  setLabel("playerDetailsSelect", "choosePlayer");
  setLabel("h2hP1", "firstPlayer");
  setLabel("h2hP2", "secondPlayer");
  setLabel("h2hT1P1", "team1p1");
  setLabel("h2hT1P2", "team1p2");
  setLabel("h2hT2P1", "team2p1");
  setLabel("h2hT2P2", "team2p2");

  // Inputs/buttons
  const playerNameInput = document.getElementById("playerName");
  if (playerNameInput) playerNameInput.placeholder = T("newPlayerNamePh");

  const addPlayerBtn = document.getElementById("addPlayerBtn");
  if (addPlayerBtn) addPlayerBtn.textContent = T("addPlayer");

  const togglePlayersBtn = document.getElementById("togglePlayersListBtn");
  if (togglePlayersBtn) togglePlayersBtn.textContent = (playersListVisible ? T("hidePlayersList") : T("showPlayersList"));

  const addMatchBtn = document.getElementById("addMatchBtn");
  if (addMatchBtn) addMatchBtn.textContent = T("saveMatch");

  const toggleMatchesBtn = document.getElementById("toggleMatchesLogBtn");
  if (toggleMatchesBtn) toggleMatchesBtn.textContent = (matchesLogVisible ? T("hideLog") : T("showLog"));

const lbToggleBtn = document.getElementById("leaderboardToggleViewBtn");
if (lbToggleBtn) lbToggleBtn.textContent = (leaderboardViewMode === "compact") ? T("detailedView") : T("compactView");

  const h2hBtn = document.getElementById("h2hAnalyzeBtn");
  if (h2hBtn) h2hBtn.textContent = T("analyze");

  const h2hTeamsBtn = document.getElementById("h2hTeamsAnalyzeBtn");
  if (h2hTeamsBtn) h2hTeamsBtn.textContent = T("analyze");

  const enableAdminBtn = document.getElementById("enableAdminBtn");
  if (enableAdminBtn) enableAdminBtn.textContent = T("enableAdmin");
  const disableAdminBtn = document.getElementById("disableAdminBtn");
  if (disableAdminBtn) disableAdminBtn.textContent = T("disableAdmin");

  const resetAllBtn = document.getElementById("resetAllBtn");
  if (resetAllBtn) resetAllBtn.textContent = T("resetAll");
  const backupBtn = document.getElementById("backupBtn");
  if (backupBtn) backupBtn.textContent = T("backupSoon");
  const importBtn = document.getElementById("importBtn");
  if (importBtn) importBtn.textContent = T("importSoon");
  const exportBtn = document.getElementById("exportBtn");
  if (exportBtn) exportBtn.textContent = T("exportSoon");

  // Static helper texts by id
  const idTextKeys = [
    ["matchesLogIntro","matchesLogIntro"],
    ["playerDetailsHelp","playerDetailsHelp"],
    ["h2hHelp","h2hHelp"],
    ["h2hTeamsHelp","h2hTeamsHelp"],

    // Match form notes
    ["matchDateHintText","matchDateHint"],
    ["matchNoteText","matchNote"],

    // Player analysis (single player)
    ["lblTotalWins","totalWinsPeriod"],
    ["lblTotalLosses","totalLossesPeriod"],
    ["lblTotalMatches","totalMatchesPeriod"],
    ["lblWinRatePeriod","winRatePeriod"],
    ["lblBonusPlus","bonusPlusLabel"],
    ["lblBonusMinus","bonusMinusLabel"],
    ["lblBonusNet","bonusNetLabel"],

    ["playerDaysAnalysisTitle","playerDaysAnalysisTitle"],
    ["lblDaysWin2","daysWin2"],
    ["lblDaysWin3","daysWin3"],
    ["lblDaysWin4p","daysWin4plus"],
    ["lblDaysLose2","daysLose2"],
    ["lblDaysLose3","daysLose3"],
    ["lblDaysLose4p","daysLose4plus"],

    ["playerBestMateTitle","playerBestMateTitle"],
    ["lblBestMateWin","bestMateWinLabel"],
    ["lblBestMateLose","bestMateLoseLabel"],

    ["playerBestOppTitle","playerBestOppTitle"],
    ["lblBestOppWin","bestOppWinLabel"],
    ["lblBestOppLose","bestOppLoseLabel"],

    ["lblCountTimes1","countTimesLabel"],
    ["lblCountTimes2","countTimesLabel"],
    ["lblCountTimes3","countTimesLabel"],
    ["lblCountTimes4","countTimesLabel"],

    // Admin notes
    ["resetWarning1","resetWarning1"],
    ["resetWarning2","resetWarning2"],

    ["note1","note1"],
    ["note2","note2"],
    ["note3","note3"],
    ["registeredPlayersLabel","registeredPlayers"]
  ];
  idTextKeys.forEach(([id,key])=>{
    const el = document.getElementById(id);
    if(el) el.textContent = T(key);
  });

// Matches log table headers
const thMap = [
  ["thMatchesDate","date"],
  ["thMatchesWin","winningTeam"],
  ["thMatchesLose","losingTeam"],
  ["thMatchesDelete","delete"],
  ["thPlayersPlayer","playersTablePlayer"],
  ["thPlayersActions","playersTableActions"]
];
thMap.forEach(([id,key])=>{
  const el=document.getElementById(id);
  if(el) el.textContent = T(key);
});

  // Filter dropdown static options
  const fy = document.getElementById("filterYear");
  if (fy){
    const optAll = fy.querySelector('option[value="all"]');
    if (optAll) optAll.textContent = T("allYears");
  }
  const fm = document.getElementById("filterMonth");
  if (fm){
    const optAll = fm.querySelector('option[value="all"]');
    if (optAll) optAll.textContent = T("allMonths");
    // month options 1..12
    for(let m=1;m<=12;m++){
      const opt = fm.querySelector(`option[value="${m}"]`);
      if(opt) opt.textContent = monthName(m);
    }
  }

  // Admin data title
  const dataTitle = document.getElementById("dataAdminTitle");
  if (dataTitle) dataTitle.textContent = T("dataAdminTitle");

  // Champions hint
  const champHint = document.getElementById("championsLogHint");
  if (champHint) champHint.textContent = T("championsLogHint");

  // Re-render any dynamic sections that have language-dependent labels
  try { updatePlayersUI(); } catch(e){}
  try { updateLeaderboard(); } catch(e){}
  try { updateMatchesLog(); } catch(e){}
  try { updateChampionsLog(); } catch(e){}
  try { updatePlayerDetailsUI(); } catch(e){}
  try { updateHeadToHeadUI(false); } catch(e){}

  // If H2H results are currently shown, re-run analysis to refresh translated output
  try{
    const out1 = document.getElementById("h2hSummary");
    const hasHelp1 = out1 && out1.querySelector && out1.querySelector("#h2hHelp");
    const p1 = document.getElementById("h2hP1")?.value;
    const p2 = document.getElementById("h2hP2")?.value;
    if(out1 && !hasHelp1 && p1 && p2 && typeof analyzeHeadToHead === "function"){
      analyzeHeadToHead();
    }
  }catch(e){}

  try{
    const out2 = document.getElementById("h2hTeamsSummary");
    const hasHelp2 = out2 && out2.querySelector && out2.querySelector("#h2hTeamsHelp");
    const t1p1 = document.getElementById("h2hT1P1")?.value;
    const t1p2 = document.getElementById("h2hT1P2")?.value;
    const t2p1 = document.getElementById("h2hT2P1")?.value;
    const t2p2 = document.getElementById("h2hT2P2")?.value;
    if(out2 && !hasHelp2 && t1p1 && t1p2 && t2p1 && t2p2 && typeof analyzeTeamsHeadToHead === "function"){
      analyzeTeamsHeadToHead();
    }
  }catch(e){}
}

function getTheme() {
  return localStorage.getItem("dl_theme") || "light";
}
function applyTheme(theme) {
  document.body.classList.toggle("dark", theme === "dark");
  const btn = document.getElementById("themeToggleBtn");
  if (btn) btn.textContent = (theme === "dark") ? T("lightMode") : T("darkMode");
}
function toggleTheme() {
  const next = (getTheme() === "dark") ? "light" : "dark";
  localStorage.setItem("dl_theme", next);
  applyTheme(next);
}


    // ===== BONUS (Streak Bonus) =====
    // ÙŠØ¸Ù‡Ø± Ø²Ø± Ø§Ù„Ø¨ÙˆÙ†Øµ ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø§Ø­ØªÙ…Ø§Ù„ T("streak"):
    // Ø¢Ø®Ø± Ù…Ø§ØªØ´ Ù…Ø³Ø¬Ù„ ÙƒØ§Ù† Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø±Ø¨Ø¹ Ù„Ø§Ø¹Ø¨ÙŠÙ† + Ù†ÙØ³ ØªÙ‚Ø³ÙŠÙ…Ø© Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† + Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙØ§Ø².
    let bonusEligible = false;
    let bonusApplied  = false;
    let bonusValue    = 0;
    let bonusSuggested = 0;

    function normTeam(arr){
      return (arr || []).slice().sort();
    }
    function teamsEqual(a,b){
      if(a.length !== b.length) return false;
      for(let i=0;i<a.length;i++) if(a[i]!==b[i]) return false;
      return true;
    }

    function getLatestMatch(){
      if(!state.matches || state.matches.length===0) return null;
      const sorted = [...state.matches].sort((a,b)=>{
        const ta = a.createdAt && a.createdAt.seconds ? a.createdAt.seconds : 0;
        const tb = b.createdAt && b.createdAt.seconds ? b.createdAt.seconds : 0;
        if(tb !== ta) return tb - ta;
        return (b.date || "").localeCompare(a.date || "");
      });
      return sorted[0] || null;
    }

    function updateBonusEligibility(){
      const btn = $("bonusBtn");
      if(!btn) return;

      // Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§: ØºÙŠØ± Ù…ØªØ§Ø­
      bonusEligible = false;
      bonusSuggested = 0;

      // Ù„Ùˆ Ù…Ø´ Ù…Ø¯ÙŠØ± -> Ù…Ø®ÙÙŠ/Ù…Ù‚ÙÙˆÙ„
      if(!isAdmin){
        bonusApplied = false;
        bonusValue = 0;
        btn.disabled = true;
        btn.classList.remove("bonus-ready");
        btn.textContent = T("bonusUnavailable");
        return;
      }

      const w1=$("winnerP1")?.value || "";
      const w2=$("winnerP2")?.value || "";
      const l1=$("loserP1")?.value || "";
      const l2=$("loserP2")?.value || "";

      if(!w1 || !w2 || !l1 || !l2){
        bonusApplied = false;
        bonusValue = 0;
        btn.disabled = true;
        btn.classList.remove("bonus-ready");
        btn.textContent = T("bonusUnavailable");
        return;
      }

      const chosen=[w1,w2,l1,l2];
      if(new Set(chosen).size < 4){
        bonusApplied = false;
        bonusValue = 0;
        btn.disabled = true;
        btn.classList.remove("bonus-ready");
        btn.textContent = T("bonusUnavailable");
        return;
      }

      const latest = getLatestMatch();
      if(!latest){
        bonusApplied = false;
        bonusValue = 0;
        btn.disabled = true;
        btn.classList.remove("bonus-ready");
        btn.textContent = T("bonusUnavailable");
        return;
      }

      const curW = normTeam([w1,w2]);
      const curL = normTeam([l1,l2]);

      const lastW = normTeam(latest.winners || []);
      const lastL = normTeam(latest.losers || []);

      // Ù†ÙØ³ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…Ø© + Ù†ÙØ³ Ø§Ù„ÙØ§Ø¦Ø² = Ø§Ø­ØªÙ…Ø§Ù„ Ø³ØªØ±ÙŠÙƒ
      if(teamsEqual(curW, lastW) && teamsEqual(curL, lastL)){
        bonusEligible = true;
        const lastBonus = (latest.bonusApplied ? (Number(latest.bonusValue)||0) : 0);
        bonusSuggested = lastBonus + 1;
      }

      if(!bonusEligible){
        bonusApplied = false;
        bonusValue = 0;
        btn.disabled = true;
        btn.classList.remove("bonus-ready");
        btn.textContent = T("bonusUnavailable");
        return;
      }

      // Ù…ØªØ§Ø­: Ù†ÙØ¹Ù‘Ù„ Ø§Ù„Ø²Ø± ÙˆÙ†Ø¸Ù„Ù„Ù‡
      btn.disabled = false;
      btn.classList.add("bonus-ready");

      // Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ø´ Ù…ØªÙØ¹Ù„ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
      if(!bonusApplied){
        btn.textContent = `${T("bonusAdd")} (+${bonusSuggested})`;
      }else{
        btn.textContent = `${T("bonusEnabled")} (+${bonusValue})`;
      }
    }

    function toggleBonus(){
      if(!isAdmin) return;
      if(!bonusEligible) return;

      bonusApplied = !bonusApplied;
      if(bonusApplied){
        bonusValue = bonusSuggested || 1;
      }else{
        bonusValue = 0;
      }
      updateBonusEligibility();
    }


    // ÙˆØ¶Ø¹ Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ (Ù…Ø®ØªØµØ± / ØªÙØµÙŠÙ„ÙŠ) + Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ø²
    let leaderboardViewMode = "compact"; // "compact" Ø£Ùˆ "detailed"
    let leaderboardSort = {
      column: "points",   // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ÙØ±Ø²
      direction: "desc"   // "asc" Ø£Ùˆ "desc"
    };

    function getLeaderboardColumns(){
      if(leaderboardViewMode === "compact"){
        return [
          {key:"rank",   label:T("rank")},
          {key:"name",   label:T("player")},
          {key:"points", label:T("points")},
          {key:"bonusNet", label:T("bonus")},
          {key:"wins",   label:T("wins")},
          {key:"losses", label:T("losses")},
          {key:"matches",label:T("matches")},
          {key:"rate",   label:T("winRate")}
        ];
      } else {
        return [
          {key:"rank",   label:T("rank")},
          {key:"name",   label:T("player")},
          {key:"points", label:T("points")},
          {key:"bonusNet", label:T("bonus")},
          {key:"wins",   label:T("wins")},
          {key:"losses", label:T("losses")},
          {key:"matches",label:T("matches")},
          {key:"rate",   label:T("winRate")},
          {key:"w2",     label:T("w2")},
          {key:"w3",     label:T("w3")},
          {key:"w4",     label:T("w4")},
          {key:"l2",     label:T("l2")},
          {key:"l3",     label:T("l3")},
          {key:"l4",     label:T("l4")}
        ];
      }
    }

    
    function applyLeaderboardSort(rows){
      const col = leaderboardSort.column;
      const dir = leaderboardSort.direction === "asc" ? 1 : -1;

      // âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
      // 1) Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (Points + Bonus)
      // 2) Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² (WinRate) ÙÙŠ Ø­Ø§Ù„ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·
      // 3) Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ÙÙˆØ²
      // 4) Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª
      // 5) Ø§Ù„Ø§Ø³Ù…
      function sortByFinalPoints(a,b){
        const ap = (a.finalPoints ?? 0), bp = (b.finalPoints ?? 0);
        if(bp !== ap) return bp - ap;

        const ar = (a.rate ?? 0), br = (b.rate ?? 0);
        if(br !== ar) return br - ar;

        const aw = (a.wins ?? 0), bw = (b.wins ?? 0);
        if(bw !== aw) return bw - aw;

        const am = (a.matches ?? 0), bm = (b.matches ?? 0);
        if(bm !== am) return bm - am;

        return a.name.localeCompare(b.name,"ar");
      }

      // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ¹Ù…Ù„ ÙØ±Ø² Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·/Ø§Ù„ØªØ±ØªÙŠØ¨ -> Ù†Ø·Ø¨Ù‚ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      if(col === "points" || col === "rank"){
        rows.sort(sortByFinalPoints);
        if(dir === -1){
          // desc (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ): Ù„Ø§ Ø´ÙŠØ¡
        } else {
          // asc: Ù†Ø¹ÙƒØ³
          rows.reverse();
        }
        return;
      }

      // ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…
      if(col === "name"){
        rows.sort((a,b)=> dir * a.name.localeCompare(b.name,"ar"));
        return;
      }

      // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: ÙØ±Ø² Ø¨Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø«Ù… Ø§Ù„Ø§Ø³Ù…
      rows.sort((a,b)=>{
        const av = a[col] ?? 0;
        const bv = b[col] ?? 0;
        if(av < bv) return -1 * dir;
        if(av > bv) return  1 * dir;
        // ÙƒØ³Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ø¨Ø§Ù„Ø§Ø³Ù…
        return a.name.localeCompare(b.name,"ar");
      });
    }


    function $(id){return document.getElementById(id);}

    // ===== Firebase init =====
    function initFirebase(){
      const firebaseConfig = {
        apiKey: "AIzaSyDmNo5FIHlW6fcZmCh0TVYzjc9NIia_iM8",
        authDomain: "domino-league-c2d94.firebaseapp.com",
        projectId: "domino-league-c2d94",
        storageBucket: "domino-league-c2d94.firebasestorage.app",
        messagingSenderId: "928957805726",
        appId: "1:928957805726:web:d6f7bc867cbfb6c824f78f",
        measurementId: "G-J2TJQD7QQ"
      };

      // ØªØ´ØºÙŠÙ„ Firebase Ø¨Ù†Ø³Ø®Ø© compat Ø§Ù„Ù„ÙŠ Ø­Ø§Ø·ÙŠÙ†Ù‡Ø§ ÙÙŠ <script> ÙÙˆÙ‚
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();

      // Firebase status indicator
      try {
        const s = document.getElementById("fbStatus");
        if(s) s.textContent = "Firebase: connected (listening for data...)";
      } catch(e) {}


      // Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
      db.collection("players").onSnapshot(snapshot => {
        const players = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          players.push({
            id: doc.id,
            name: data.name,
            avatar: data.avatar || null,
            banPeriods: data.banPeriods || []
          });
        });
        state.players = players;
        updatePlayersUI();
        updateLeaderboard();
        updatePlayerDetailsUI();
        updateMatchesLog();
        updateBonusEligibility();
        updateChampionsLog();
            }, (err)=>{
        console.error("players onSnapshot error:", err);
        const s = document.getElementById("fbStatus");
        if(s) s.textContent = "Firebase error (players): " + (err?.message || err);
      });

      // Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª
      db.collection("matches").onSnapshot(snapshot => {
        const matches = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          matches.push({
            id: doc.id,
            date: data.date || null,
            winners: data.winners || [],
            losers: data.losers || [],
            players: data.players || [],
            createdAt: data.createdAt || null,
            bonusApplied: data.bonusApplied || false,
            bonusValue: Number(data.bonusValue || 0)
                }, (err)=>{
        console.error("matches onSnapshot error:", err);
        const s = document.getElementById("fbStatus");
        if(s) s.textContent = "Firebase error (matches): " + (err?.message || err);
      });
        });
        state.matches = matches;
        updateFilterYearOptions();
        updateLeaderboard();
        updatePlayerDetailsUI();
        updateHeadToHeadUI(false);
        updateMatchesLog();
        updateChampionsLog();
      });
    }

    // ===== ADMIN =====
    function updateAdminUI(){
      const ids = ["addPlayerBtn","addMatchBtn","resetAllBtn","bonusBtn"];
      ids.forEach(id=>{
        const el=$(id);
        if(el) el.disabled = !isAdmin;
      });
      ["playerName","playerAvatarFile","matchDate","winnerP1","winnerP2","loserP1","loserP2"]
        .forEach(id=>{
          const el=$(id);
          if(el) el.disabled = !isAdmin;
        });

      $("enableAdminBtn").style.display = isAdmin ? "none" : "inline-block";
      $("disableAdminBtn").style.display = isAdmin ? "inline-block" : "none";
      $("adminStatusText").textContent = isAdmin ? T("adminEnabled") : T("adminViewOnly");

      // Ø¹Ù„Ø´Ø§Ù† Ø£Ø²Ø±Ø§Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØªØ¸Ù‡Ø±/ØªØ®ØªÙÙŠ Ø­Ø³Ø¨ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±
      updateMatchesLog();
      updatePlayersUI();
      updateBonusEligibility();
    }

    function enableAdminMode(){
      const pin = prompt((getLang()==="en") ? "Enter admin PIN:" : "Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯ÙŠØ±:");
      if(pin === null) return;
      if(pin === ADMIN_PIN){
        isAdmin = true;
        alert((getLang()==="en") ? "Admin mode enabled." : "ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±.");
      } else {
        alert((getLang()==="en") ? "Incorrect PIN." : "ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.");
      }
      updateAdminUI();
    }

    function disableAdminMode(){
      isAdmin = false;
      updateAdminUI();
    }

    // ===== TOGGLE MATCHES LOG =====
    function toggleMatchesLog(){
      const wrapper = $("matchesLogWrapper");
      const btn = $("toggleMatchesLogBtn");
      if(!wrapper || !btn) return;
      matchesLogVisible = !matchesLogVisible;
      wrapper.style.display = matchesLogVisible ? "" : "none";
      btn.textContent = matchesLogVisible ? T("hideLog") : T("showLog");
    }

    function togglePlayersList(){
      const wrapper = $("playersListWrapper");
      const btn = $("togglePlayersListBtn");
      if(!wrapper || !btn) return;
      playersListVisible = !playersListVisible;
      wrapper.style.display = playersListVisible ? "" : "none";
      btn.textContent = playersListVisible ? T("hidePlayersList") : T("showPlayersList");
      }

    // ===== PLAYERS =====
    function getPlayerById(id){
      return state.players.find(p=>p.id===id) || null;
    }

    function getPlayerNameById(id){
      const p = getPlayerById(id);
      return p ? p.name : (`${T("idPrefix")} $<built-in function id>`);
    }


    // ===== BAN / UNBAN helpers =====
    function tsToDate(v){
      if(!v) return null;
      if(typeof v.toDate === "function") return v.toDate();
      if(typeof v.seconds === "number") return new Date(v.seconds * 1000);
      // fallback (string/date)
      return new Date(v);
    }

    function isDateInBanPeriods(dateObj, banPeriods){
      if(!dateObj) return false;
      const t = dateObj.getTime();
      const periods = banPeriods || [];
      return periods.some(p=>{
        const fromD = tsToDate(p.from);
        const toD   = p.to ? tsToDate(p.to) : null;
        if(!fromD) return false;
        const from = fromD.getTime();
        const to   = toD ? toD.getTime() : null;
        return (to === null) ? (t >= from) : (t >= from && t <= to);
      });
    }

    function isPlayerCurrentlyBanned(player){
      const periods = (player && player.banPeriods) ? player.banPeriods : [];
      return periods.some(p => p && p.to == null);
    }

    // âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© = Ø¢Ø®Ø± ØªØ§Ø±ÙŠØ® Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± (ÙˆÙ„Ùˆ Ù…ÙÙŠØ´ØŒ Ù†Ø³ØªØ®Ø¯Ù… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…)
    function getSelectedRangeEndDate(){
      const yearVal = $("filterYear")?.value || "all";
      const monthVal = $("filterMonth")?.value || "all";
      const now = new Date();

      // âœ… Ù„Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø¹Ù„Ù‰ Ø´Ù‡Ø± Ù…Ø­Ø¯Ø¯: Ù†Ù‡Ø§ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± (Ø­ØªÙ‰ Ù„Ùˆ Ø¢Ø®Ø± Ù…Ø§ØªØ´ ÙÙŠ Ø§Ù„Ø´Ù‡Ø± ÙƒØ§Ù† Ø¨Ø¯Ø±ÙŠ)
      if(yearVal !== "all" && monthVal !== "all"){
        const y = Number(yearVal);
        const m = Number(monthVal); // 1-12
        return new Date(y, m, 0, 23, 59, 59, 999); // Ø¢Ø®Ø± ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø´Ù‡Ø±
      }

      // âœ… Ù„Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø¹Ù„Ù‰ Ø³Ù†Ø© Ù…Ø­Ø¯Ø¯Ø©: Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ù†Ø©
      if(yearVal !== "all" && monthVal === "all"){
        const y = Number(yearVal);
        return new Date(y, 11, 31, 23, 59, 59, 999); // 31 Ø¯ÙŠØ³Ù…Ø¨Ø±
      }

      // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª (ÙƒÙ„ Ø§Ù„Ø³Ù†ÙŠÙ†/ÙƒÙ„ Ø§Ù„ÙˆÙ‚Øª): Ù†Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± ØªØ§Ø±ÙŠØ® Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
      const matches = getFilteredMatches();
      let max = null;
      matches.forEach(m=>{
        if(!m.date) return;
        const d = new Date(m.date + "T23:59:59");
        if(!max || d > max) max = d;
      });
      return max || now;
    }

    // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ T("selectedRangeEnd")
    function shouldShowPlayerForSelectedRange(player, rangeEndDate){
      return !isDateInBanPeriods(rangeEndDate, player.banPeriods || []);
    }


    
    function updatePlayersUI(){
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ø¨Ø¬Ø¯ÙŠÙ‹Ø§ Ø¨Ø§Ù„Ø§Ø³Ù…
      const playersAll = [...state.players].sort((a,b)=> a.name.localeCompare(b.name,"ar"));

      // âœ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø§ØªØ´Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©: Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø­Ø¸ÙˆØ± Ø­Ø§Ù„ÙŠÙ‹Ø§
      const playersForMatch = playersAll.filter(p => !isPlayerCurrentlyBanned(p));

      // âœ… Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª/Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      const rangeEnd = getSelectedRangeEndDate();
      const playersForAnalytics = playersAll.filter(p => shouldShowPlayerForSelectedRange(p, rangeEnd));

      const scoreSelectIds = ["winnerP1","winnerP2","loserP1","loserP2"];
      const analyticsSelectIds = [
        "playerDetailsSelect",
        "h2hP1",
        "h2hP2",
        "h2hT1P1",
        "h2hT1P2",
        "h2hT2P1",
        "h2hT2P2"
      ];

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ select Ø¨ØªØ§Ø¹Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª
      scoreSelectIds.forEach(id=>{
        const sel=$(id); if(!sel) return;
        const current = sel.value;
        sel.innerHTML="";
        const opt=document.createElement("option");
        opt.value=""; opt.textContent=T("selectPlayer");
        sel.appendChild(opt);

        playersForMatch.forEach(p=>{
          const o=document.createElement("option");
          o.value=p.id; o.textContent=p.name;
          sel.appendChild(o);
        });

        // Ø­Ø§ÙˆÙ„ ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ùˆ Ù…Ø§Ø²Ø§Ù„ Ù…ØªØ§Ø­
        if(current && playersForMatch.some(p=>p.id===current)) sel.value=current;
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ select Ø¨ØªØ§Ø¹Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª
      analyticsSelectIds.forEach(id=>{
        const sel=$(id); if(!sel) return;
        const current = sel.value;
        sel.innerHTML="";
        const opt=document.createElement("option");
        opt.value=""; opt.textContent=T("selectPlayer");
        sel.appendChild(opt);

        playersForAnalytics.forEach(p=>{
          const o=document.createElement("option");
          o.value=p.id; o.textContent=p.name;
          sel.appendChild(o);
        });

        if(current && playersForAnalytics.some(p=>p.id===current)) sel.value=current;
        else if(id === "playerDetailsSelect"){
          // Ù„Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø± Ø§Ø®ØªÙÙ‰ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±/Ø§Ù„ÙØªØ±Ø©ØŒ Ù†Ø®ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„
          updatePlayerDetailsUI();
        }
      });

      // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù†ØµÙŠ ØªØ­Øª Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
      const info = $("playersListInfo");
      if(info){
        if(playersAll.length===0){
          info.textContent=T("noPlayersYet");
        } else {
          info.textContent = `${T("registeredPlayers")}: ` + playersAll.map(p=>p.name).join((getLang()==="en") ? ", " : "ØŒ ");
        }
      }

      // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø¹Ø±Ø¶ + ØªØ¹Ø¯ÙŠÙ„ + Ø­Ø¸Ø±/Ø­Ø°Ù)
      const tbody = $("playersTableBody");
      if(!tbody) return;
      tbody.innerHTML = "";

      if(playersAll.length===0){
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 3;
        td.textContent = T("noPlayersYetShort");
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      playersAll.forEach((p, idx)=>{
        const tr = document.createElement("tr");

        // Ø±Ù‚Ù…
        const tdIndex = document.createElement("td");
        tdIndex.textContent = idx + 1;
        tr.appendChild(tdIndex);

        // Ø§Ù„Ù„Ø§Ø¹Ø¨ (ØµÙˆØ±Ø© + Ø§Ø³Ù… + Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±)
        const tdPlayer = document.createElement("td");
        const wrapper = document.createElement("div");
        wrapper.className = "player-cell";

        if(p.avatar){
          const img = document.createElement("img");
          img.src = p.avatar;
          img.className = "player-avatar";
          wrapper.appendChild(img);
        }

        const span = document.createElement("span");
        span.textContent = p.name;
        wrapper.appendChild(span);

        // Badge Ù„Ù„Ø­Ø§Ù„Ø©
        const bannedNow = isPlayerCurrentlyBanned(p);
        const badge = document.createElement("span");
        badge.style.fontSize = "0.75rem";
        badge.style.padding = "2px 6px";
        badge.style.borderRadius = "999px";
        badge.style.border = "1px solid #ddd";
        badge.style.marginRight = "6px";
        badge.textContent = bannedNow ? T("statusBanned") : T("statusActive");
        wrapper.appendChild(badge);

        tdPlayer.appendChild(wrapper);
        tr.appendChild(tdPlayer);

        // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
        const tdActions = document.createElement("td");
        if(isAdmin){
          // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…
          const editBtn = document.createElement("button");
          editBtn.textContent = T("editName");
          editBtn.className = "btn-small";
          editBtn.addEventListener("click", ()=>editPlayerName(p.id, p.name));
          tdActions.appendChild(editBtn);

          // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
          const imgBtn = document.createElement("button");
          imgBtn.textContent = T("avatarBtn");
          imgBtn.className = "btn-small";
          imgBtn.style.marginRight = "4px";

          const fileInput = document.createElement("input");
          fileInput.type = "file";
          fileInput.accept = "image/*";
          fileInput.style.display = "none";
          fileInput.addEventListener("change", ()=>{
            const file = fileInput.files[0];
            if(file){
              changePlayerAvatar(p.id, file);
            }
            fileInput.value = "";
          });
          imgBtn.addEventListener("click", ()=>fileInput.click());

          tdActions.appendChild(imgBtn);
          tdActions.appendChild(fileInput);

          // Ø­Ø¸Ø± / ÙÙƒ Ø§Ù„Ø­Ø¸Ø±
          const banBtn = document.createElement("button");
          banBtn.className = "btn-small";
          banBtn.style.marginRight = "4px";
          banBtn.textContent = bannedNow ? T("unbanBtn") : T("banBtn");
          banBtn.addEventListener("click", async ()=>{
            if(bannedNow){
              if(!confirm(`${T("confirmUnbanPlayer")} "${p.name}"?`)) return;
              await unbanPlayer(p.id);
            } else {
              if(!confirm(`${T("confirmBanPlayer")} "${p.name}"?

${T("banExplanation")}`)) return;
              await banPlayer(p.id);
            }
          });
          tdActions.appendChild(banBtn);

          // Ø­Ø°Ù Ù„Ø§Ø¹Ø¨ (Ù†Ù‡Ø§Ø¦ÙŠ)
          const delBtn = document.createElement("button");
          delBtn.textContent = T("deleteBtn");
          delBtn.className = "danger btn-small";
          delBtn.addEventListener("click", ()=> deletePlayerAndMatches(p.id, p.name));
          tdActions.appendChild(delBtn);

        } else {
          tdActions.textContent = T("noneDash");
        }

        tr.appendChild(tdActions);
        tbody.appendChild(tr);
      });

      // ØªØ­Ø¯ÙŠØ« Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¨ÙˆÙ†Øµ Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
      updateBonusEligibility();
    }


    function addPlayer(){
      if(!isAdmin || !db) return;
      const nameInput = $("playerName");
      const fileInput = $("playerAvatarFile");
      const name = nameInput.value.trim();
      if(!name){ alert(T("enterPlayerNameFirst")); return; }

      const finishAdd = (avatarData)=>{
        db.collection("players").add({
          name,
          avatar: avatarData || null,
          banPeriods: []
        }).then(()=>{
          nameInput.value="";
          fileInput.value="";
        }).catch(err=>{
          console.error(err);
          alert(T("errAddPlayer"));
        });
      };

      const file = fileInput.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = e => finishAdd(e.target.result);
        reader.readAsDataURL(file);
      } else {
        finishAdd(null);
      }
    }

    function editPlayerName(playerId, currentName){
      if(!isAdmin || !db) return;
      const newName = prompt(T("promptNewPlayerName"), currentName || "");
      if(newName === null) return; // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØºÙ‰
      const trimmed = newName.trim();
      if(!trimmed){
        alert(T("nameCannotBeEmpty"));
        return;
      }
      db.collection("players").doc(playerId).update({ name: trimmed })
        .catch(err=>{
          console.error(err);
          alert(T("errEditPlayerName"));
        });
    }

    function changePlayerAvatar(playerId, file){
      if(!isAdmin || !db || !file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const avatarData = e.target.result;
        db.collection("players").doc(playerId).update({ avatar: avatarData })
          .catch(err=>{
            console.error(err);
            alert(T("errUpdateAvatar"));
          });
      };
      reader.readAsDataURL(file);
    }

    // ===== ADMIN: Delete Player (delete player + all matches retroactively) =====
    async function deletePlayerAndMatches(playerId, playerName){
      if(!isAdmin || !db) return;

      const typed = prompt(
        `âš ï¸ Ø­Ø°Ù Ù„Ø§Ø¹Ø¨ Ù†Ù‡Ø§Ø¦ÙŠ\n\nØ§Ù„Ù„Ø§Ø¹Ø¨: ${playerName}\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ + Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ø§Ù„ØªÙŠ Ø´Ø§Ø±Ùƒ ÙÙŠÙ‡Ø§ Ø¨Ø£Ø«Ø± Ø±Ø¬Ø¹ÙŠ.\n\nØ§ÙƒØªØ¨ DELETE Ù„Ù„ØªØ£ÙƒÙŠØ¯:`
      );
      if(typed !== "DELETE") return;

      const typedName = prompt(`Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù„Ù„ØªØ£ÙƒÙŠØ¯:\n${playerName}`);
      if(typedName !== playerName) return;

      // Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª Ø§Ù„ØªÙŠ Ø´Ø§Ø±Ùƒ ÙÙŠÙ‡Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø¯ÙˆÙƒÙŠÙˆÙ…Ù†ØªØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ø§ ØªØ­ØªÙˆÙŠ players[])
      const snap = await db.collection("matches").get();
      const toDelete = [];
      snap.forEach(doc=>{
        const d = doc.data() || {};
        const w = d.winners || [];
        const l = d.losers  || [];
        const p = d.players || [];
        if(w.includes(playerId) || l.includes(playerId) || p.includes(playerId)){
          toDelete.push(doc.ref);
        }
      });

      // Ø­Ø°Ù Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙÙŠ Ø¯ÙØ¹Ø§Øª
      let deletedCount = 0;
      for(let i=0;i<toDelete.length;i+=400){
        const batch = db.batch();
        toDelete.slice(i,i+400).forEach(ref=> batch.delete(ref));
        await batch.commit();
        deletedCount += Math.min(400, toDelete.length - i);
      }

      // Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨
      await db.collection("players").doc(playerId).delete();

      alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ "${playerName}" ÙˆØ­Ø°Ù ${deletedCount} Ù…Ø§ØªØ´(Ø§Øª) Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.`);
      // Ø§Ù„Ù€ onSnapshot Ù‡ÙŠØªÙˆÙ„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    }

    // ===== ADMIN: Ban / Unban =====
    async function banPlayer(playerId){
      if(!isAdmin || !db) return;
      const ref = db.collection("players").doc(playerId);
      const now = firebase.firestore.Timestamp.now();

      await db.runTransaction(async (tx)=>{
        const doc = await tx.get(ref);
        if(!doc.exists) return;
        const data = doc.data() || {};
        const periods = (data.banPeriods || []).slice();

        // Ù„Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø­Ø¸ÙˆØ± Ø­Ø§Ù„ÙŠÙ‹Ø§
        if(periods.some(p => p && p.to == null)) return;

        periods.push({ from: now, to: null });
        tx.update(ref, { banPeriods: periods });
      });
    }

    async function unbanPlayer(playerId){
      if(!isAdmin || !db) return;
      const ref = db.collection("players").doc(playerId);
      const now = firebase.firestore.Timestamp.now();

      await db.runTransaction(async (tx)=>{
        const doc = await tx.get(ref);
        if(!doc.exists) return;
        const data = doc.data() || {};
        const periods = (data.banPeriods || []).slice();

        // Ø§Ù‚ÙÙ„ Ø£Ø­Ø¯Ø« ÙØªØ±Ø© Ø­Ø¸Ø± Ù…ÙØªÙˆØ­Ø©
        for(let i=periods.length-1;i>=0;i--){
          if(periods[i] && periods[i].to == null){
            periods[i] = { ...periods[i], to: now };
            break;
          }
        }
        tx.update(ref, { banPeriods: periods });
      });
    }


      // ===== MATCHES ===== }

    // ===== MATCHES =====
    function addMatch(){
      if(!isAdmin || !db) return;
      if(state.players.length<4){ alert(T("needAtLeast4Players")); return; }
      const w1=$("winnerP1").value;
      const w2=$("winnerP2").value;
      const l1=$("loserP1").value;
      const l2=$("loserP2").value;
      if(!w1||!w2||!l1||!l2){ alert(T("selectAllPlayers")); return; }
      const chosen=[w1,w2,l1,l2];
      if(new Set(chosen).size<4){ alert(T("samePlayerNotAllowed")); return; }

      // âœ… Ù…Ù…Ù†ÙˆØ¹ ØªØ³Ø¬ÙŠÙ„ Ù…Ø§ØªØ´ Ø¬Ø¯ÙŠØ¯ Ù„Ùˆ Ø£ÙŠ Ù„Ø§Ø¹Ø¨ Ù…Ø­Ø¸ÙˆØ± Ø­Ø§Ù„ÙŠÙ‹Ø§
      const now = new Date();
      for(const pid of chosen){
        const pl = getPlayerById(pid);
        if(pl && isPlayerCurrentlyBanned(pl)){
          alert(`Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§ØªØ´ Ù„Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ "${pl.name}" Ù…Ø­Ø¸ÙˆØ± Ø­Ø§Ù„ÙŠÙ‹Ø§.`);
          return;
        }
      }

      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
      updateBonusEligibility();
      if(bonusApplied && !bonusEligible){
        bonusApplied = false; bonusValue = 0;
      }

      let dateStr=$("matchDate").value;
      if(!dateStr){
        const now=new Date();
        const y=now.getFullYear();
        const m=String(now.getMonth()+1).padStart(2,"0");
        const d=String(now.getDate()).padStart(2,"0");
        dateStr=`${y}-${m}-${d}`;
      }

      db.collection("matches").add({
        date: dateStr,
        winners:[w1,w2],
        losers:[l1,l2],
        players:[w1,w2,l1,l2],
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        bonusApplied: bonusApplied || false,
        bonusValue: bonusApplied ? (Number(bonusValue)||0) : 0
      }).then(()=>{
        $("matchDate").value="";
        ["winnerP1","winnerP2","loserP1","loserP2"].forEach(id=>$(id).value="");
        bonusApplied = false;
        bonusValue = 0;
        updateBonusEligibility();
      }).catch(err=>{
        console.error(err);
        alert(T("errSaveMatch"));
      });
    }

    function resetAll(){
      if(!isAdmin || !db) return;
      if(!confirm(T("confirmResetAll"))) return;

      // Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª
      db.collection("matches").get().then(snap=>{
        const batch = db.batch();
        snap.forEach(doc=>batch.delete(doc.ref));
        return batch.commit();
      }).then(()=>{
        return db.collection("players").get();
      }).then(snap=>{
        const batch = db.batch();
        snap.forEach(doc=>batch.delete(doc.ref));
        return batch.commit();
      }).catch(err=>{
        console.error(err);
        alert(T("errResetData"));
      });
    }
    // ===== MATCHES LOG (Ø¹Ø±Ø¶ + Ø­Ø°Ù) =====
    function deleteMatchById(id){
      if(!isAdmin || !db) return;
      if(!confirm(T("confirmDeleteMatch"))) return;
      db.collection("matches").doc(id).delete().catch(err=>{
        console.error(err);
        alert(T("errDeleteMatch"));
      });
    }

    
    // ===== CHAMPIONS LOG (Monthly podiums per selected year) =====
    function updateChampionsLog(){
  const yearVal = $("filterYear")?.value || "all";
  const monthVal = $("filterMonth")?.value || "all";
  const wrapper = $("championsLogWrapper");
  const hint = $("championsLogHint");
  const title = $("championsLogTitle");
  const head = $("championsLogHead");
  const body = $("championsLogBody");
  const extra = $("championsLogExtra");

  if(!wrapper || !head || !body || !title || !hint) return;
  if(extra) extra.innerHTML = "";

  // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ø¹Ù„Ù‰ "ÙƒÙ„ Ø§Ù„Ø³Ù†ÙŠÙ†"
  if(yearVal === "all"){
    wrapper.style.display = "none";
    hint.style.display = "block";
    head.innerHTML = "";
    body.innerHTML = "";
    // Ù„ÙƒÙ† Ù†Ù‚Ø¯Ø± Ù†Ø¸Ù‡Ø± Ø§Ù„Ø£Ù„Ù‚Ø§Ø¨ Ù„Ùˆ Ø­Ø§Ø¨Ø¨ (Ø­Ø§Ù„ÙŠØ§Ù‹ Ø§Ù„Ø£Ù„Ù‚Ø§Ø¨ ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ØªØ®ØªØ§Ø± Ø³Ù†Ø©)
    return;
  }

  const year = Number(yearVal);
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth() + 1; // 1-12

  const monthNames = (MONTHS[getLang()] || MONTHS.ar);

  // ===== Robust date helpers (string / Firestore Timestamp / Date) =====
  function matchToDate(mm){
    const d = mm?.date;
    if(!d) return null;
    if(d instanceof Date) return d;
    // Firestore Timestamp (compat)
    if(typeof d === "object" && typeof d.toDate === "function") return d.toDate();
    if(typeof d === "string"){
      // supports YYYY-MM-DD or ISO strings
      const parsed = new Date(d);
      return Number.isNaN(parsed.getTime()) ? null : parsed;
    }
    // numeric millis
    if(typeof d === "number"){
      const parsed = new Date(d);
      return Number.isNaN(parsed.getTime()) ? null : parsed;
    }
    return null;
  }

  function matchYearMonth(mm){
    const dt = matchToDate(mm);
    if(!dt) return null;
    return { y: dt.getFullYear(), m: dt.getMonth() + 1 };
  }

  

  // Helper: end-of-month date (used for ban visibility rule)
  function endOfMonthDate(y, m){ // m:1-12
    const d = new Date(y, m, 0); // last day of month m
    d.setHours(23,59,59,999);
    return d;
  }


  // âœ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ + ØªØ­Ø¯ÙŠØ¯ Ø¨Ø·Ù„ Ø§Ù„Ø´Ù‡Ø±/Ø§Ù„Ø³Ù†Ø©)
  // 1) Final Points = Points + Bonus
  // 2) Win Rate (wins / totalMatches) Ø¹Ù†Ø¯ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·
  // 3) Wins Ø¹Ù†Ø¯ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ²
  // 4) Total Matches Ø¹Ù†Ø¯ ØªØ³Ø§ÙˆÙŠ Ù…Ø§ Ø³Ø¨Ù‚
  // 5) Name
  function compareMonthlyStanding(a,b){
    const ap = (a.finalPoints ?? 0), bp = (b.finalPoints ?? 0);
    if(bp !== ap) return bp - ap;

    const ar = (a.winRate ?? 0), br = (b.winRate ?? 0);
    if(br !== ar) return br - ar;

    const aw = (a.wins ?? 0), bw = (b.wins ?? 0);
    if(bw !== aw) return bw - aw;

    const am = (a.totalMatches ?? 0), bm = (b.totalMatches ?? 0);
    if(bm !== am) return bm - am;

    return (a.name||"").localeCompare(b.name||"", "ar");
  }

  // Ø§Ù„Ø´Ù‡Ø± T("completed") = Ø´Ù‡Ø± Ø§Ù†ØªÙ‡Ù‰ ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ù…Ø´ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ)
  function isMonthCompleted(y, m){
    if(y < currentYear) return true;
    if(y > currentYear) return false;
    // Ù†ÙØ³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    return m < currentMonth;
  }

  function hasMatchesInMonth(y, m){
    return state.matches.some(mm=>{
      const ym = matchYearMonth(mm);
      if(!ym) return false;
      return ym.y===y && ym.m===m;
    });
  }

  // ØªØ­Ø¯ÙŠØ¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù„ØªØ­Ø¯ÙŠØ¯ "Ø¢Ø®Ø± Ø´Ù‡Ø±" and "Ø¢Ø®Ø± Ø³Ù†Ø©"
  function getSelectedEndDate(){
    if(yearVal !== "all" && monthVal !== "all"){
      return endOfMonthDate(year, Number(monthVal));
    }
    // Ø³Ù†Ø© ÙÙ‚Ø·:
    if(year < currentYear) return endOfMonthDate(year, 12);
    // Ø³Ù†Ø© Ø­Ø§Ù„ÙŠØ©: Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù† (Ø­ØªÙ‰ Ù„Ùˆ ÙŠÙ†Ø§ÙŠØ±)
    return now;
  }

  function prevMonthYearFromDate(d){
    const y = d.getFullYear();
    const m = d.getMonth() + 1;
    if(m === 1) return {y: y-1, m: 12};
    return {y: y, m: m-1};
  }

  // Ø¨Ø·Ù„ Ø´Ù‡Ø± Ù…Ø­Ø¯Ø¯
  function computeChampionNameForMonth(y, m){
    if(!y || !m) return null;
    const mMatches = state.matches.filter(mm=>{
      const ym = matchYearMonth(mm);
      if(!ym) return false;
      return ym.y===y && ym.m===m;
    });
    if(mMatches.length === 0) return null;

    const rangeEnd = endOfMonthDate(y, m);

    const rows = [];
    state.players.forEach(p=>{
      if(!shouldShowPlayerForSelectedRange(p, rangeEnd)) return;
      const s = computePlayerFullStats(p.id, mMatches);
      if((s.totalMatches || 0) === 0) return;
      rows.push({
        id: p.id,
        name: p.name,
        wins: s.wins || 0,
        winRate: (s.totalMatches ? ((s.wins||0) / (s.totalMatches||0)) : 0),
        totalMatches: s.totalMatches || 0,
        finalPoints: ((s.wins||0) - (s.losses||0)) + (s.bonusNet || 0)
      });
    });
    if(rows.length === 0) return null;

    rows.sort(compareMonthlyStanding);

    return rows[0]?.name || null;
  }

  // Ø¨Ø·Ù„ Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©
  function computeChampionNameForYear(y){
    if(!y) return null;
    const yMatches = state.matches.filter(mm=>{
      const ym = matchYearMonth(mm);
      if(!ym) return false;
      return ym.y===y;
    });
    if(yMatches.length === 0) return null;

    const rangeEnd = endOfMonthDate(y, 12);

    const rows = [];
    state.players.forEach(p=>{
      if(!shouldShowPlayerForSelectedRange(p, rangeEnd)) return;
      const s = computePlayerFullStats(p.id, yMatches);
      if((s.totalMatches || 0) === 0) return;
      rows.push({
        id: p.id,
        name: p.name,
        wins: s.wins || 0,
        winRate: (s.totalMatches ? ((s.wins||0) / (s.totalMatches||0)) : 0),
        totalMatches: s.totalMatches || 0,
        finalPoints: ((s.wins||0) - (s.losses||0)) + (s.bonusNet || 0)
      });
    });
    if(rows.length === 0) return null;

    rows.sort(compareMonthlyStanding);

    return rows[0]?.name || null;
  }

  // 1) ØªØ­Ù‚Ù‚ Ù‡Ù„ ÙŠÙˆØ¬Ø¯ T("completedMonth") Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙˆÙ„Ù‡ Ù…Ø¨Ø§Ø±ÙŠØ§Øª
  const completedMonthsWithData = [];
    const maxMonthCutoff = (monthVal !== "all") ? Number(monthVal) : 12;

  for(let m=1; m<=12; m++){
    // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯ Ø´Ù‡Ø±ØŒ Ù†Ø¹Ø±Ø¶/Ù†Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡ÙˆØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© Ø­ØªÙ‰ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± ÙÙ‚Ø· (Ø´Ø§Ù…Ù„ Ø§Ù„Ø´Ù‡Ø± Ù†ÙØ³Ù‡)
    if(m > maxMonthCutoff) continue;
    if(!isMonthCompleted(year, m)) continue;
    if(!hasMatchesInMonth(year, m)) continue;
    completedMonthsWithData.push(m);
  }


  // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡
  const noCompletedMonths = (completedMonthsWithData.length === 0);
  hint.style.display = "none";
  wrapper.style.display = "block";
  const championsEmptyMessage = noCompletedMonths
    ? T("noCompletedMonthsInYear")
    : T("notEnoughDataForYear");

  // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  title.textContent = T("championsLogTitleTpl").replace("{year}", year);

  // 2) ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ + (Ø£ÙØ¶Ù„/Ø£Ø³ÙˆØ£ Ù…Ø±ÙƒØ²) Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¯Ù‚ÙŠÙ‚Ø©
  const byId = new Map();
  state.players.forEach(p=>{
    byId.set(p.id, {
      id: p.id,
      name: p.name,
      first: 0,
      second: 0,
      third: 0,
      ranks: [] // ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù†Ø©
    });
  });

  for(const month of completedMonthsWithData){
    const mMatches = state.matches.filter(mm=>{
      const ym = matchYearMonth(mm);
      if(!ym) return false;
      return ym.y===year && ym.m===month;
    });
    if(mMatches.length === 0) continue;

    const rangeEnd = endOfMonthDate(year, month);

    const rows = [];
    state.players.forEach(p=>{
      if(!shouldShowPlayerForSelectedRange(p, rangeEnd)) return;
      const s = computePlayerFullStats(p.id, mMatches);
      if((s.totalMatches || 0) === 0) return;
      rows.push({
        id: p.id,
        name: p.name,
        wins: s.wins || 0,
        winRate: (s.totalMatches ? ((s.wins||0) / (s.totalMatches||0)) : 0),
        totalMatches: s.totalMatches || 0,
        finalPoints: ((s.wins||0) - (s.losses||0)) + (s.bonusNet || 0)
      });
    });
    if(rows.length === 0) continue;

    rows.sort(compareMonthlyStanding);

    // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ù†Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
    rows.forEach((r, i)=>{
      const rec = byId.get(r.id);
      if(!rec) return;
      rec.ranks.push(i+1);
    });

    // Podium counts
    const top1 = rows[0]?.id || null;
    const top2 = rows[1]?.id || null;
    const top3 = rows[2]?.id || null;
    if(top1 && byId.get(top1)) byId.get(top1).first += 1;
    if(top2 && byId.get(top2)) byId.get(top2).second += 1;
    if(top3 && byId.get(top3)) byId.get(top3).third += 1;
  }

  // build summary
  let summary = Array.from(byId.values()).map(r=>{
    let best = (r.ranks.length ? Math.min(...r.ranks) : null);
    let worst = (r.ranks.length ? Math.max(...r.ranks) : null);

    // Safety: Ù„Ùˆ Ø¹Ù†Ø¯Ù‡ Ù…Ø±Ø§Øª Ù…Ø±ÙƒØ² Ø£ÙˆÙ„/Ø«Ø§Ù†ÙŠ/Ø«Ø§Ù„Ø« Ù„Ø§Ø²Ù… ÙŠÙ†Ø¹ÙƒØ³ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù…Ø±ÙƒØ² (Ø­ØªÙ‰ Ù„Ùˆ Ø­ØµÙ„ Ø£ÙŠ Ø®Ù„Ù„ ÙÙŠ ranks)
    if(r.first > 0) best = (best == null ? 1 : Math.min(best, 1));
    else if(r.second > 0) best = (best == null ? 2 : Math.min(best, 2));
    else if(r.third > 0) best = (best == null ? 3 : Math.min(best, 3));

    // Safety: Ù„Ùˆ Ù…ÙÙŠØ´ ranks Ù„Ø£ÙŠ Ø³Ø¨Ø¨ØŒ Ø®Ù„ÙŠ Ø§Ù„Ø£Ø³ÙˆØ£ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 3 Ù„Ùˆ Ø¹Ù†Ø¯Ù‡ Ù…ÙŠØ¯Ø§Ù„ÙŠØ©
    if(worst == null && (r.first > 0 || r.second > 0 || r.third > 0)) worst = 3;

    return { ...r, best, worst };
  }).filter(r=>{
    // ÙŠØ¸Ù‡Ø± Ù„Ùˆ Ø´Ø§Ø±Ùƒ ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù†Ø© (Ù„Ø¯ÙŠÙ‡ ranks)
    return r.ranks && r.ranks.length > 0;
  });

  // ===== Sorting state for Champions Log =====
  if(!window.championsSort){
    window.championsSort = { column: "first", direction: "desc" };
  }

  function applyChampionsSort(arr){
    const col = window.championsSort.column;
    const dir = window.championsSort.direction === "asc" ? 1 : -1;

    const num = (v, fallback)=> (typeof v === "number" && !Number.isNaN(v)) ? v : fallback;

    arr.sort((a,b)=>{
      // best: Ø§Ù„Ø£ØµØºØ± Ø£ÙØ¶Ù„ØŒ worst: Ø§Ù„Ø£ÙƒØ¨Ø± Ø£Ø³ÙˆØ£ (Ù„ÙƒÙ† Ù†Ø³Ù…Ø­ Ø¨Ø¹ÙƒØ³Ù‡ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù‡Ù…)
      if(col === "best"){
        const av = num(a.best, 9999);
        const bv = num(b.best, 9999);
        if(av !== bv) return (av - bv) * dir;
      } else if(col === "worst"){
        const av = num(a.worst, -1);
        const bv = num(b.worst, -1);
        if(av !== bv) return (av - bv) * dir;
      } else {
        const av = num(a[col], 0);
        const bv = num(b[col], 0);
        if(av !== bv) return (av - bv) * dir;
      }

      // Tie-break Ø«Ø§Ø¨Øª (Ù…Ù†Ø·Ù‚ÙŠ)
      if(b.first !== a.first) return b.first - a.first;
      if(b.second !== a.second) return b.second - a.second;
      if(b.third !== a.third) return b.third - a.third;

      // Ø§Ù„Ø£ÙØ¶Ù„/Ø§Ù„Ø£Ø³ÙˆØ£ ÙƒØªØ¹Ø§Ø¯Ù„
      const ab = num(a.best, 9999), bb = num(b.best, 9999);
      if(ab !== bb) return ab - bb;
      const aw = num(a.worst, -1), bw = num(b.worst, -1);
      if(aw !== bw) return aw - bw;

      return (a.name||"").localeCompare(b.name||"", "ar");
    });
  }

  applyChampionsSort(summary);

  // ===== Render Table =====
  head.innerHTML = "";
  body.innerHTML = "";

  const columns = [
    {label: T("rank"),      key:"rank",  sortable:false},
    {label: T("player"),    key:"name",  sortable:false},
    {label: T("first"),     key:"first", sortable:true},
    {label: T("second"),    key:"second",sortable:true},
    {label: T("third"),     key:"third", sortable:true},
    {label: T("bestRank"),  key:"best",  sortable:true},
    {label: T("worstRank"), key:"worst", sortable:true}
  ];

  const trh = document.createElement("tr");
  columns.forEach(c=>{
    const th = document.createElement("th");
    th.textContent = c.label;

    if(c.sortable){
      th.classList.add("sortable");
      th.dataset.col = c.key;

      const arrow = document.createElement("span");
      arrow.className = "sort-arrow";
      const isActive = (window.championsSort.column === c.key);
      arrow.textContent = isActive ? (window.championsSort.direction === "asc" ? "â–²" : "â–¼") : "â†•";
      th.appendChild(arrow);

      th.addEventListener("click", ()=>{
        if(window.championsSort.column === c.key){
          window.championsSort.direction = (window.championsSort.direction === "asc") ? "desc" : "asc";
        } else {
          window.championsSort.column = c.key;
          // default direction: counts desc, best asc, worst desc
          if(c.key === "best") window.championsSort.direction = "asc";
          else if(c.key === "worst") window.championsSort.direction = "desc";
          else window.championsSort.direction = "desc";
        }
        updateChampionsLog();
      });
    }

    trh.appendChild(th);
  });
  head.appendChild(trh);

  if(summary.length === 0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = columns.length;
    td.textContent = championsEmptyMessage;
    tr.appendChild(td);
    body.appendChild(tr);
  } else {
    summary.forEach((r, idx)=>{
      const tr = document.createElement("tr");
      tr.appendChild(createCell(idx+1));
      tr.appendChild(createCell(r.name || "-"));
      tr.appendChild(createCell(r.first || 0));
      tr.appendChild(createCell(r.second || 0));
      tr.appendChild(createCell(r.third || 0));
      tr.appendChild(createCell(r.best==null? "-" : r.best));
      tr.appendChild(createCell(r.worst==null? "-" : r.worst));
      body.appendChild(tr);
    });
  }

  // ===== Extra (Title holders) =====
  const endDate = getSelectedEndDate();
  const prev = prevMonthYearFromDate(endDate);

  const prevYear = endDate.getFullYear() - 1;
  const prevYearChampion = computeChampionNameForYear(prevYear);
  const prevMonthChampion = computeChampionNameForMonth(prev.y, prev.m);

  if(extra){
    extra.innerHTML = `
      <div>${T("lastYearChampion")} (<b>${prevYear}</b>): <b>${prevYearChampion || "-"}</b></div>
      <div>${T("lastMonthChampion")} (<b>${monthName(prev.m)}</b> ${prev.y}): <b>${prevMonthChampion || "-"}</b></div>
    `;
  }
}
function updateMatchesLog(){
      const tbody = $("matchesLogBody");
      if(!tbody) return;
      tbody.innerHTML = "";

      // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„ÙÙ„ØªØ± Ø¨ØªØ§Ø¹ Ø§Ù„Ø³Ù†Ø©/Ø§Ù„Ø´Ù‡Ø±
      const matches = getFilteredMatches();

      if(matches.length === 0){
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 5;
        td.textContent = T("noMatchesInPeriod");
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      // Ø£Ø­Ø¯Ø« Ù…Ø§ØªØ´ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
      const sorted = [...matches].sort((a,b)=>{
        const ta = a.createdAt && a.createdAt.seconds ? a.createdAt.seconds : 0;
        const tb = b.createdAt && b.createdAt.seconds ? b.createdAt.seconds : 0;
        if(tb !== ta) return tb - ta;
        return (b.date || "").localeCompare(a.date || "");
      });

      sorted.forEach((m,idx)=>{
        const tr = document.createElement("tr");

        tr.appendChild(createCell(idx + 1));
        const dateText = (m.date || "-") + (m.bonusApplied ? ` ğŸ+${Number(m.bonusValue||0)}` : "");
        tr.appendChild(createCell(dateText));
        tr.appendChild(createPlayersListCell(m.winners || []));
        tr.appendChild(createPlayersListCell(m.losers || []));

        const actionTd = document.createElement("td");
        if(isAdmin){
          const btn = document.createElement("button");
          btn.textContent = T("deleteBtn");
          btn.className = "danger btn-small";
          btn.addEventListener("click", ()=> deleteMatchById(m.id));
          actionTd.appendChild(btn);
        } else {
          actionTd.textContent = "-";
        }
        tr.appendChild(actionTd);

        tbody.appendChild(tr);
      });
    }

    // ===== FILTER YEAR/MONTH =====
    function updateFilterYearOptions(){
      const sel = $("filterYear");
      if(!sel) return;
      const yearsSet = new Set();
      state.matches.forEach(m=>{
        if(m.date) yearsSet.add(m.date.slice(0,4));
      });
      const current = sel.value || "all";
      sel.innerHTML = "";
      const optAll = document.createElement("option");
      optAll.value="all"; optAll.textContent="ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª";
      sel.appendChild(optAll);
      Array.from(yearsSet).sort().forEach(y=>{
        const o=document.createElement("option");
        o.value=y; o.textContent=y;
        sel.appendChild(o);
      });
      if(current && (current==="all" || yearsSet.has(current))) sel.value=current;
      else sel.value="all";
    }

    function getFilterLabel(yearVal, monthVal){
      // Localized period label
      if(yearVal !== "all" && monthVal !== "all"){
        return T("periodMonthYearTpl")
          .replace("{month}", monthName(Number(monthVal)))
          .replace("{year}", yearVal);
      } else if(yearVal !== "all"){
        return T("periodYearTpl").replace("{year}", yearVal);
      } else if(monthVal !== "all"){
        return T("periodMonthAllYearsTpl")
          .replace("{month}", monthName(Number(monthVal)));
      }
      return T("periodAllTime");
    }

    function getFilteredMatches(){
      const yearVal = $("filterYear").value;
      const monthVal = $("filterMonth").value;
      let filtered = state.matches;

      if(yearVal !== "all"){
        const y = Number(yearVal);
        filtered = filtered.filter(m => m.date && Number(m.date.slice(0,4)) === y);
        if(monthVal !== "all"){
          const mo = Number(monthVal);
          filtered = filtered.filter(m => m.date && Number(m.date.slice(5,7)) === mo);
        }
      } else if(monthVal !== "all"){
        const mo = Number(monthVal);
        filtered = filtered.filter(m => m.date && Number(m.date.slice(5,7)) === mo);
      }
      return filtered;
    }

    function createCell(text){
      const td=document.createElement("td");
      td.textContent=text;
      return td;
    }

    function createPlayerCellTd(playerId){
      const td=document.createElement("td");
      const p=getPlayerById(playerId);
      if(!p){ td.textContent=T("unknown"); return td; }
      const wrapper=document.createElement("div");
      wrapper.className="player-cell";
      if(p.avatar){
        const img=document.createElement("img");
        img.src=p.avatar;
        img.className="player-avatar";
        wrapper.appendChild(img);
      }
      const span=document.createElement("span");
      span.textContent=p.name;
      wrapper.appendChild(span);
      td.appendChild(wrapper);
      return td;
    }

    function createPlayersListCell(ids){
      const td=document.createElement("td");
      ids.forEach((id,idx)=>{
        if(idx>0) td.appendChild(document.createTextNode(" + "));
        const p=getPlayerById(id);
        const wrapper=document.createElement("span");
        wrapper.className="player-cell";
        if(p && p.avatar){
          const img=document.createElement("img");
          img.src=p.avatar;
          img.className="player-avatar";
          wrapper.appendChild(img);
        }
        const span=document.createElement("span");
        span.textContent=p ? p.name : (`${T("idPrefix")} $<built-in function id>`);
        wrapper.appendChild(span);
        td.appendChild(wrapper);
      });
      return td;
    }

    // ===== LEADERBOARD =====
    function updateLeaderboard(){
      const matches = getFilteredMatches();
      const yearVal  = $("filterYear").value;
      const monthVal = $("filterMonth").value;
      $("currentFilterLabel").textContent = getFilterLabel(yearVal, monthVal);

      const rows = [];

      // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ù…Ù†Ø·Ù‚ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
      state.players.forEach(p => {
        // âœ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ØªÙ‚Ø¹ Ø¯Ø§Ø®Ù„ ÙØªØ±Ø© Ø§Ù„Ø­Ø¸Ø±
        if(!shouldShowPlayerForSelectedRange(p, getSelectedRangeEndDate())) return;

        const s = computePlayerFullStats(p.id, matches);

        // Ù„Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø§ Ù„Ø¹Ø¨Ø´ ÙˆÙ„Ø§ Ù…Ø§ØªØ´ ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø¯ÙŠØŒ Ø¨Ù†Ø®ÙÙ‘ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
        if(s.totalMatches === 0) return;

        rows.push({
          id:       p.id,
          name:     p.name,
          wins:     s.wins,
          losses:   s.losses,
          matches:  s.totalMatches,
          basePoints: (s.wins - s.losses),
          finalPoints: (s.wins - s.losses) + (s.bonusNet || 0),
          points:   (s.wins - s.losses) + (s.bonusNet || 0),
          bonusPlus: s.bonusPlus || 0,
          bonusMinus: s.bonusMinus || 0,
          bonusNet: s.bonusNet || 0,
          rate:     s.winRate,
          // Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ 2 / 3 / 4+ ÙÙˆØ²
          w2:       s.daysWin2,
          w3:       s.daysWin3,
          w4:       s.daysWin4plus,
          // Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ 2 / 3 / 4+ Ø®Ø³Ø§Ø±Ø©
          l2:       s.daysLose2,
          l3:       s.daysLose3,
          l4:       s.daysLose4plus
        });
      });

      const cols = getLeaderboardColumns();

      // Ù†Ø·Ø¨Ù‘Ù‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ø² Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      applyLeaderboardSort(rows);

      // Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const thead = $("leaderboardHead");
      thead.innerHTML = "";
      const headerTr = document.createElement("tr");

      cols.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col.label;
        th.classList.add("sortable");
        th.dataset.col = col.key;

        const arrow = document.createElement("span");
        arrow.className = "sort-arrow";
        if (leaderboardSort.column === col.key) {
          arrow.textContent = leaderboardSort.direction === "asc" ? "â–²" : "â–¼";
        } else {
          arrow.textContent = "â†•";
        }

        th.appendChild(document.createTextNode(" "));
        th.appendChild(arrow);

        th.addEventListener("click", () => {
          if (leaderboardSort.column === col.key) {
            leaderboardSort.direction =
              leaderboardSort.direction === "asc" ? "desc" : "asc";
          } else {
            leaderboardSort.column   = col.key;
            leaderboardSort.direction = (col.key === "name") ? "asc" : "desc";
          }
          updateLeaderboard();
        });

        headerTr.appendChild(th);
      });

      thead.appendChild(headerTr);

      // Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const tbody = $("leaderboardBody");
      tbody.innerHTML = "";

      if (rows.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = cols.length;
        td.textContent = T("noResultsInPeriod");
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      rows.forEach((r, idx) => {
        const tr = document.createElement("tr");
        r.rank = idx + 1; // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ±Ø²

        cols.forEach(col => {
          if (col.key === "name") {
            // Ø®Ù„ÙŠØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ (ØµÙˆØ±Ø© + Ø§Ø³Ù…)
            tr.appendChild(createPlayerCellTd(r.id));
          } else {
            let value;
            if (col.key === "rate") {
              value = r.rate.toFixed(1) + " Ùª";
            } else if (col.key === "rank") {
              value = r.rank;
            } else {
              value = r[col.key] ?? 0;
            }
            tr.appendChild(createCell(value));
          }
        });

        tbody.appendChild(tr);
      });
    }

    // ===== PLAYER ANALYSIS (Ø¨ÙØªØ±Ø© Ø§Ù„ÙÙ„ØªØ±) =====
    
    function computePlayerFullStats(playerId, matches){
      let wins = 0, losses = 0;
      let bonusPlus = 0, bonusMinus = 0;

      const dayMap = new Map();
      const teammateWin  = new Map(), teammateLose  = new Map();
      const opponentWin  = new Map(), opponentLose  = new Map();

      matches.forEach(m=>{
        const d = m.date || T("noDate");
        if(!dayMap.has(d)) dayMap.set(d,{w:0,l:0});
        const ds = dayMap.get(d);

        const isW = (m.winners || []).includes(playerId);
        const isL = (m.losers  || []).includes(playerId);

        if(isW){
          wins++; ds.w++;
          if(m.bonusApplied){ bonusPlus += Number(m.bonusValue||0); }

          // Ø²Ù…Ù„Ø§Ø¡ Ø§Ù„ÙÙˆØ²
          (m.winners || []).forEach(pid=>{
            if(pid!==playerId)
              teammateWin.set(pid,(teammateWin.get(pid)||0)+1);
          });

          // Ø§Ù„Ø®ØµÙˆÙ… Ø§Ù„Ù„ÙŠ Ø®Ø³Ø±ÙˆØ§ Ù…Ù†ÙŠ
          (m.losers || []).forEach(pid=>{
            opponentWin.set(pid,(opponentWin.get(pid)||0)+1);
          });
        }

        if(isL){
          losses++; ds.l++;
          if(m.bonusApplied){ bonusMinus += Number(m.bonusValue||0); }

          // Ø²Ù…Ù„Ø§Ø¡ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
          (m.losers || []).forEach(pid=>{
            if(pid!==playerId)
              teammateLose.set(pid,(teammateLose.get(pid)||0)+1);
          });

          // Ø§Ù„Ø®ØµÙˆÙ… Ø§Ù„Ù„ÙŠ ÙƒØ³Ø¨ÙˆØ§ Ø¹Ù„ÙŠÙ‘
          (m.winners || []).forEach(pid=>{
            opponentLose.set(pid,(opponentLose.get(pid)||0)+1);
          });
        }
      });

      const total=wins+losses;
      const rate=total>0?(wins/total)*100:0;

      let dW2=0,dW3=0,dW4=0,dL2=0,dL3=0,dL4=0;
      dayMap.forEach(ds=>{
        if(ds.w===2)dW2++; else if(ds.w===3)dW3++; else if(ds.w>=4)dW4++;
        if(ds.l===2)dL2++; else if(ds.l===3)dL3++; else if(ds.l>=4)dL4++;
      });

      function best(map){
        let bestCount = 0;
        map.forEach((c)=>{ if(c > bestCount) bestCount = c; });
        if(bestCount === 0) return [];
        const result = [];
        map.forEach((c,id)=>{
          if(c === bestCount){
            const p = getPlayerById(id);
            result.push({
              id,
              name: p ? p.name : (T("idPrefix") + " " + id),
              count: c
            });
          }
        });
        return result;
      }

      return {
        wins,
        losses,
        totalMatches: total,
        winRate: rate,
        bonusPlus,
        bonusMinus,
        bonusNet: bonusPlus - bonusMinus,

        daysWin2: dW2,
        daysWin3: dW3,
        daysWin4plus: dW4,
        daysLose2: dL2,
        daysLose3: dL3,
        daysLose4plus: dL4,

        bestTeammateWin:  best(teammateWin),
        bestTeammateLose: best(teammateLose),
        bestOpponentWin:  best(opponentWin),
        bestOpponentLose: best(opponentLose)
      };
    }

    function updatePlayerDetailsUI(){
      const sel=$("playerDetailsSelect");
      const summary=$("playerDetailsSummary");
      const box=$("playerDetailsStats");
      if(!sel || !sel.value){
                summary.textContent = T("selectPlayerAnalysis");
        box.style.display="none"; return;
      }
      const id=sel.value;
      const player=getPlayerById(id);
      if(!player){summary.textContent = T("playerIdNotFound");box.style.display="none";return;}

      // âœ… Ù„Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø­Ø¸ÙˆØ± Ø­Ø³Ø¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©ØŒ Ù†Ø®ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„
      if(!shouldShowPlayerForSelectedRange(player, getSelectedRangeEndDate())){
                summary.textContent = T("playerBannedInPeriodTpl").replace("{name}", player.name);
        box.style.display = "none";
        return;
      }

      const matches = getFilteredMatches();
      const s=computePlayerFullStats(id, matches);

      const yearVal = $("filterYear").value;
      const monthVal = $("filterMonth").value;
      const label = getFilterLabel(yearVal, monthVal);

            summary.innerHTML = T("playerAnalysisTitleTpl").replace("{name}", `<strong>${player.name}</strong>`).replace("{period}", label);

      $("pTotalWins").textContent=s.wins;
      $("pTotalLosses").textContent=s.losses;
      $("pTotalMatches").textContent=s.totalMatches;
      $("pWinRate").textContent=s.winRate.toFixed(1)+"Ùª";
      $("pBonusPlus").textContent = s.bonusPlus || 0;
      $("pBonusMinus").textContent = s.bonusMinus || 0;
      $("pBonusNet").textContent = s.bonusNet || 0;

      $("pDaysWin2").textContent=s.daysWin2;
      $("pDaysWin3").textContent=s.daysWin3;
      $("pDaysWin4plus").textContent=s.daysWin4plus;
      $("pDaysLose2").textContent=s.daysLose2;
      $("pDaysLose3").textContent=s.daysLose3;
      $("pDaysLose4plus").textContent=s.daysLose4plus;

      // Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ù…ÙØ¶Ù„ (Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ù…Ù† ÙˆØ§Ø­Ø¯)
      if(s.bestTeammateWin && s.bestTeammateWin.length > 0){
        $("pBestMateWinName").textContent =
          s.bestTeammateWin.map(x => x.name).join(" ØŒ ");
        $("pBestMateWinCount").textContent = s.bestTeammateWin[0].count;
      } else {
        $("pBestMateWinName").textContent = "-";
        $("pBestMateWinCount").textContent = "0";
      }

      if(s.bestTeammateLose && s.bestTeammateLose.length > 0){
        $("pBestMateLoseName").textContent =
          s.bestTeammateLose.map(x => x.name).join(" ØŒ ");
        $("pBestMateLoseCount").textContent = s.bestTeammateLose[0].count;
      } else {
        $("pBestMateLoseName").textContent = "-";
        $("pBestMateLoseCount").textContent = "0";
      }

      // Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ÙØ¶Ù„ (Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ ÙƒØ³Ø¨Øª Ø¶Ø¯Ù‡ / Ø®Ø³Ø±Øª Ø¶Ø¯Ù‡)
      if(s.bestOpponentWin && s.bestOpponentWin.length > 0){
        $("pBestOppWinName").textContent =
          s.bestOpponentWin.map(x => x.name).join(" ØŒ ");
        $("pBestOppWinCount").textContent = s.bestOpponentWin[0].count;
      } else {
        $("pBestOppWinName").textContent = "-";
        $("pBestOppWinCount").textContent = "0";
      }

      if(s.bestOpponentLose && s.bestOpponentLose.length > 0){
        $("pBestOppLoseName").textContent =
          s.bestOpponentLose.map(x => x.name).join(" ØŒ ");
        $("pBestOppLoseCount").textContent = s.bestOpponentLose[0].count;
      } else {
        $("pBestOppLoseName").textContent = "-";
        $("pBestOppLoseCount").textContent = "0";
      }

      box.style.display="block";
    }

    // ===== H2H (Ø¨ÙØªØ±Ø© Ø§Ù„ÙÙ„ØªØ±) =====
    function updateHeadToHeadUI(reset=true){
      if(reset) $("h2hSummary").innerHTML = '<span id="h2hHelp">'+T("h2hHelp")+'</span>';
    }


function analyzeHeadToHead(){
  const p1Str = $("h2hP1").value;
  const p2Str = $("h2hP2").value;
  const out   = $("h2hSummary");

  if(!p1Str || !p2Str){
    out.textContent = T("chooseTwoPlayersFirst");
    return;
  }

  const p1 = p1Str, p2 = p2Str;
  if(p1 === p2){
    out.textContent = T("samePlayerSelectedTwice");
    return;
  }

  const pl1 = getPlayerById(p1),
        pl2 = getPlayerById(p2);
  if(!pl1 || !pl2){
    out.textContent = T("playerNotFound");
    return;
  }

  const matches = getFilteredMatches();

  // vs: Ø¶Ø¯ Ø¨Ø¹Ø¶ â€“ p1W / p2W
  // team: Ù…Ø¹ Ø¨Ø¹Ø¶ â€“ teamWins / teamLosses
  let vs = 0, p1W = 0, p2W = 0;
  let team = 0, teamWins = 0, teamLosses = 0;

  // ğŸ†• transfers
  let baseNet = 0;   // + ÙŠØ¹Ù†ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 2
  let bonusNet = 0;  // + ÙŠØ¹Ù†ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ 2

  matches.forEach(m=>{
    const w = m.winners || [];
    const l = m.losers  || [];

    const p1Win  = w.includes(p1);
    const p1Lose = l.includes(p1);
    const p2Win  = w.includes(p2);
    const p2Lose = l.includes(p2);

    // Ù…Ø¹ Ø¨Ø¹Ø¶ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚
    if( (p1Win && p2Win) || (p1Lose && p2Lose) ){
      team++;
      if(p1Win && p2Win)  teamWins++;
      if(p1Lose && p2Lose) teamLosses++;
      return;
    }

    // Ø¶Ø¯ Ø¨Ø¹Ø¶
    if( (p1Win && p2Lose) || (p2Win && p1Lose) ){
      vs++;
      const b = (m.bonusApplied ? Number(m.bonusValue||0) : 0);

      if(p1Win && p2Lose){
        p1W++;
        baseNet += 1;
        bonusNet += b;
      }
      if(p2Win && p1Lose){
        p2W++;
        baseNet -= 1;
        bonusNet -= b;
      }
    }
  });

  const yearVal  = $("filterYear").value;
  const monthVal = $("filterMonth").value;
  const label    = getFilterLabel(yearVal, monthVal);

  let html = T("h2hReportTitleTpl")
    .replace("{p1}", `<strong>${pl1.name}</strong>`)
    .replace("{p2}", `<strong>${pl2.name}</strong>`)
    .replace("{period}", label);

  html += T("h2hPlayedAgainstTpl").replace("{n}", `<strong>${vs}</strong>`);
  html += T("h2hP1BeatP2Tpl")
    .replace("{p1}", `<strong>${pl1.name}</strong>`)
    .replace("{p2}", pl2.name)
    .replace("{n}", `<strong>${p1W}</strong>`);
  html += T("h2hP2BeatP1Tpl")
    .replace("{p2}", `<strong>${pl2.name}</strong>`)
    .replace("{p1}", pl1.name)
    .replace("{n}", `<strong>${p2W}</strong>`);
  html += T("h2hPlayedSameTeamTpl").replace("{n}", `<strong>${team}</strong>`);

  if(vs > 0){
    const r1 = (p1W / vs) * 100;
    const r2 = (p2W / vs) * 100;
    html += T("h2hWinRateVsTitle");
    html += `â€¢ ${pl1.name}: <strong>${r1.toFixed(1)}%</strong><br/>`;
    html += `â€¢ ${pl2.name}: <strong>${r2.toFixed(1)}%</strong><br/>`;
  }

  // Same team results
  if(team > 0){
    const teamWinRate  = (teamWins   / team) * 100;
    const teamLoseRate = (teamLosses / team) * 100;
    html += T("h2hSameTeamRateTitle");
    html += T("h2hSameTeamWinTpl")
      .replace("{rate}", `<strong>${teamWinRate.toFixed(1)}%</strong>`)
      .replace("{wins}", teamWins)
      .replace("{total}", team);
    html += T("h2hSameTeamLoseTpl")
      .replace("{rate}", `<strong>${teamLoseRate.toFixed(1)}%</strong>`)
      .replace("{losses}", teamLosses)
      .replace("{total}", team);
  }

  // Bonus & base points
  html += T("h2hBonusTitle");
  html += T("h2hBaseTitle");
  html += T("receivedPointsByNamesTpl")
    .replace("{to}", `<strong>${p1Name}</strong>`)
    .replace("{from}", `<strong>${p2Name}</strong>`)
    .replace("{n}", `<strong>${p1FromP2Base}</strong>`);
  html += T("receivedPointsByNamesTpl")
    .replace("{to}", `<strong>${p2Name}</strong>`)
    .replace("{from}", `<strong>${p1Name}</strong>`)
    .replace("{n}", `<strong>${p2FromP1Base}</strong>`);

  out.innerHTML = html;
}

// Auto-run H2H analysis when both players are selected
function autoAnalyzeHeadToHeadIfReady(force){
  const p1 = $("h2hP1")?.value || "";
  const p2 = $("h2hP2")?.value || "";
  if(p1 && p2 && p1 !== p2){
    analyzeHeadToHead();
  }else{
    // Reset to help text (no errors while selecting)
    const out = $("h2hSummary");
    if(out) out.innerHTML = '<span id="h2hHelp">'+T("h2hHelp")+'</span>';
  }
}

// Auto-run Teams H2H analysis when all 4 players are selected
function autoAnalyzeTeamsHeadToHeadIfReady(){
  const a1 = $("h2hT1P1")?.value || "";
  const a2 = $("h2hT1P2")?.value || "";
  const b1 = $("h2hT2P1")?.value || "";
  const b2 = $("h2hT2P2")?.value || "";
  if(a1 && a2 && b1 && b2){
    analyzeTeamsHeadToHead();
  }else{
    const out = $("h2hTeamsSummary");
    if(out) out.innerHTML = '<span id="h2hTeamsHelp">'+T("h2hTeamsHelp")+'</span>';
  }
}


    // ===== TEAMS H2H (2 Ø¶Ø¯ 2) =====
    function normalizeTeamId(p1, p2){
      if(!p1 || !p2) return null;
      // Ù†Ø®Ù„ÙŠ Ø§Ù„Ù€ ID Ø«Ø§Ø¨Øª Ù…Ù‡Ù…Ø§ ÙƒØ§Ù† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
      return (p1 < p2) ? (p1 + "|" + p2) : (p2 + "|" + p1);
    }

    function resetTeamsH2HSummary(){
      const el = $("h2hTeamsSummary");
      if(el){
        el.innerHTML = '<span id="h2hTeamsHelp">'+T("h2hTeamsHelp")+'</span>';
      }
    }

    function analyzeTeamsHeadToHead(){
      const t1p1 = $("h2hT1P1").value;
      const t1p2 = $("h2hT1P2").value;
      const t2p1 = $("h2hT2P1").value;
      const t2p2 = $("h2hT2P2").value;
      const out  = $("h2hTeamsSummary");

      if(!out) return;

      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
      if(!t1p1 || !t1p2 || !t2p1 || !t2p2){
        out.textContent = T("chooseTeamsPlayersFirst");
        return;
      }

      // Ù…Ù…Ù†ÙˆØ¹ Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØªÙƒØ±Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚
      if(t1p1 === t1p2 || t2p1 === t2p2){
        out.textContent = T("samePlayerSameTeam");
        return;
      }

      // Ù„Ùˆ Ø­Ø§Ø¨Ø¨ ØªÙ…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù„Ø§Ø¹Ø¨ Ø¨ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ†:
      const all = [t1p1,t1p2,t2p1,t2p2];
      if(new Set(all).size < 4){
        out.textContent = T("samePlayerBothTeams");
        return;
      }

      const team1Id = normalizeTeamId(t1p1, t1p2);
      const team2Id = normalizeTeamId(t2p1, t2p2);

      if(team1Id === team2Id){
        out.textContent = T("cannotCompareSameTeam");
        return;
      }

      const t1Name =
        getPlayerNameById(t1p1) + " + " + getPlayerNameById(t1p2);
      const t2Name =
        getPlayerNameById(t2p1) + " + " + getPlayerNameById(t2p2);

      const matches = getFilteredMatches();

      let vs = 0;
      let t1Wins = 0;
      let t2Wins = 0;

      matches.forEach(m=>{
        if(!m.winners || !m.losers) return;
        if(m.winners.length !== 2 || m.losers.length !== 2) return;

        const wTeamId = normalizeTeamId(m.winners[0], m.winners[1]);
        const lTeamId = normalizeTeamId(m.losers[0], m.losers[1]);

        if(!wTeamId || !lTeamId) return;

        // Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† Ø¨Ø§Ù„Ø¸Ø¨Ø·ØŸ
        if(
          (wTeamId === team1Id && lTeamId === team2Id) ||
          (wTeamId === team2Id && lTeamId === team1Id)
        ){
          vs++;
          if(wTeamId === team1Id) t1Wins++;
          if(wTeamId === team2Id) t2Wins++;
        }
      });

      const yearVal  = $("filterYear").value;
      const monthVal = $("filterMonth").value;
      const label    = getFilterLabel(yearVal, monthVal);

      if(vs === 0){
        out.innerHTML = T("h2hTeamsNoVsTpl")
          .replace("{t1}", t1Name)
          .replace("{t2}", t2Name)
          .replace("{period}", label);
        return;
      }

      const t1Rate = (t1Wins / vs) * 100;
      const t2Rate = (t2Wins / vs) * 100;

      let html = T("h2hTeamsReportTitleTpl")
        .replace("{t1}", `<strong>${t1Name}</strong>`)
        .replace("{t2}", `<strong>${t2Name}</strong>`)
        .replace("{period}", label);

      html += T("h2hTeamsPlayedAgainstTpl").replace("{n}", `<strong>${vs}</strong>`);
      html += T("h2hTeamsT1WinsTpl").replace("{t1}", `<strong>${t1Name}</strong>`).replace("{n}", `<strong>${t1Wins}</strong>`);
      html += T("h2hTeamsT2WinsTpl").replace("{t2}", `<strong>${t2Name}</strong>`).replace("{n}", `<strong>${t2Wins}</strong>`);
      html += T("h2hTeamsWinRateTitle");
      html += `â€¢ ${t1Name}: <strong>${t1Rate.toFixed(1)}%</strong><br/>`;
      html += `â€¢ ${t2Name}: <strong>${t2Rate.toFixed(1)}%</strong><br/>`;

      out.innerHTML = html;
    }

    // ===== INIT =====
    function init(){
      initFirebase();
      updateAdminUI();
      updateBonusEligibility();
      ["winnerP1","winnerP2","loserP1","loserP2"].forEach(id=>{
        const el=$(id);
        if(el) el.addEventListener("change", updateBonusEligibility);
      });


      // âœ… Ø¶Ø¨Ø· Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù„Ù‰ "Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ"
      const now = new Date();
      const currentYear  = String(now.getFullYear());
      const currentMonth = String(now.getMonth() + 1); // Ù…Ù† 1 Ø¥Ù„Ù‰ 12

      const fy = $("filterYear");
      const fm = $("filterMonth");

      // Ù†Ø¶Ù…Ù† Ø¥Ù† Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ ÙˆÙ„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø© Ù†Ø¶ÙŠÙÙ‡Ø§
      if(fy){
        let yearOpt = Array.from(fy.options).find(o => o.value === currentYear);
        if(!yearOpt){
          yearOpt = document.createElement("option");
          yearOpt.value = currentYear;
          yearOpt.textContent = currentYear;
          fy.appendChild(yearOpt);
        }
        fy.value = currentYear;
      }

      if(fm){
        fm.value = currentMonth; // Ù„Ø£Ù† Ø§Ù„Ø´Ù‡ÙˆØ± 1..12 Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù€ HTML
      }

      // Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©      updateLeaderboard();
      updateChampionsLog();
      updateMatchesLog();
      updateHeadToHeadUI(true);
      if($("playerDetailsSelect")) updatePlayerDetailsUI();

      // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù„Ø³ØªÙŠÙ†Ø±Ø² Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ
      $("addPlayerBtn").addEventListener("click",addPlayer);
      $("addMatchBtn").addEventListener("click",addMatch);
      $("bonusBtn").addEventListener("click",toggleBonus);
      $("resetAllBtn").addEventListener("click",resetAll);
      $("playerDetailsSelect").addEventListener("change",updatePlayerDetailsUI);
      const __h2hBtn = $("h2hAnalyzeBtn");
      if(__h2hBtn){ __h2hBtn.addEventListener("click", analyzeHeadToHead); }
      // Auto-run when selecting players
      ["h2hP1","h2hP2"].forEach(id=>{
        const el = $(id);
        if(el) el.addEventListener("change", autoAnalyzeHeadToHeadIfReady);
      });
      $("enableAdminBtn").addEventListener("click",enableAdminMode);
      $("disableAdminBtn").addEventListener("click",disableAdminMode);

      // â­ Ø²Ø±Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ±Ù‚ 2 Ø¶Ø¯ 2
      const h2hTeamsBtn = $("h2hTeamsAnalyzeBtn");
      if (h2hTeamsBtn){
        h2hTeamsBtn.addEventListener("click", analyzeTeamsHeadToHead);
      }
      // Auto-run when selecting team players
      ["h2hT1P1","h2hT1P2","h2hT2P1","h2hT2P2"].forEach(id=>{
        const el = $(id);
        if(el) el.addEventListener("change", autoAnalyzeTeamsHeadToHeadIfReady);
      });

      $("filterYear").addEventListener("change",()=>{
        updatePlayersUI();
        updateLeaderboard();
        if($("playerDetailsSelect").value) updatePlayerDetailsUI();
        if($("h2hP1").value && $("h2hP2").value) analyzeHeadToHead(); 
        else updateHeadToHeadUI(true);

        updateMatchesLog();
        updateChampionsLog();
        updateChampionsLog();
        // â­ Ø±Ø¬Ù‘Ø¹ Ù†Øµ Ù…Ù„Ø®Øµ Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„ÙØ±Ù‚ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        resetTeamsH2HSummary();
      });

      $("filterMonth").addEventListener("change",()=>{
        updatePlayersUI();
        updateLeaderboard();
        if($("playerDetailsSelect").value) updatePlayerDetailsUI();
        if($("h2hP1").value && $("h2hP2").value) analyzeHeadToHead(); 
        else updateHeadToHeadUI(true);

        updateMatchesLog();
        updateChampionsLog();
        // â­ Ø¨Ø±Ø¶Ù‡ Ù†Ø±Ø¬Ù‘Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„ÙØ±Ù‚
        resetTeamsH2HSummary();
      });

      const toggleViewBtn = $("leaderboardToggleViewBtn");
      if(toggleViewBtn){
        toggleViewBtn.addEventListener("click", ()=>{
          leaderboardViewMode = (leaderboardViewMode === "compact") ? "detailed" : "compact";
          toggleViewBtn.textContent = (leaderboardViewMode === "compact") ? T("detailedView") : T("compactView");
          updateLeaderboard();
          if($("playerDetailsSelect").value) updatePlayerDetailsUI();
          if($("h2hP1").value && $("h2hP2").value) analyzeHeadToHead(); 
          else updateHeadToHeadUI(true);

          // Ù…Ø´ Ù„Ø§Ø²Ù… Ù‡Ù†Ø§ Ù†Ø­Ù„Ù„ Ø§Ù„ÙØ±Ù‚ ØªØ§Ù†ÙŠØŒ Ø¨Ø³ Ù„Ùˆ Ø­Ø§Ø¨Ø¨:
          // resetTeamsH2HSummary();
        });
      }

      $("togglePlayersListBtn").addEventListener("click", togglePlayersList);
      $("toggleMatchesLogBtn").addEventListener("click", toggleMatchesLog);
    }

    document.addEventListener("DOMContentLoaded",init);
  
  // ===== Init Theme + Language =====
  (function(){
    const langSelect = document.getElementById("langSelect");
    if (langSelect) {
      langSelect.value = getLang();
      langSelect.addEventListener("change", (e) => setLang(e.target.value));
    }
    const themeBtn = document.getElementById("themeToggleBtn");
    if (themeBtn) themeBtn.addEventListener("click", toggleTheme);

    applyLang(getLang());
    applyTheme(getTheme());
  })();

</script>
</body>
</html>

